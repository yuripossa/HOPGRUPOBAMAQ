<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>StagingPPLB1</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2023/09/06 14:28:14.661</created_date>
    <modified_user>-</modified_user>
    <modified_date>2023/09/06 14:28:14.661</modified_date>
  </info>
  <notepads>
    <notepad>
      <backgroundcolorblue>210</backgroundcolorblue>
      <backgroundcolorgreen>136</backgroundcolorgreen>
      <backgroundcolorred>15</backgroundcolorred>
      <bordercolorblue>250</bordercolorblue>
      <bordercolorgreen>231</bordercolorgreen>
      <bordercolorred>200</bordercolorred>
      <fontbold>Y</fontbold>
      <fontcolorblue>250</fontcolorblue>
      <fontcolorgreen>231</fontcolorgreen>
      <fontcolorred>200</fontcolorred>
      <fontitalic>N</fontitalic>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <height>525</height>
      <xloc>96</xloc>
      <yloc>16</yloc>
      <note>***	                                                                 STAGING - RAW DATA                                                                          ***
DADOS BASE CADASTRAL PROJETO LEAD CLIENTES

                  
























 




*** 				        </note>
      <width>623</width>
    </notepad>
    <notepad>
      <backgroundcolorblue>192</backgroundcolorblue>
      <backgroundcolorgreen>192</backgroundcolorgreen>
      <backgroundcolorred>192</backgroundcolorred>
      <bordercolorblue>90</bordercolorblue>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorred>14</bordercolorred>
      <fontbold>Y</fontbold>
      <fontcolorblue>90</fontcolorblue>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorred>14</fontcolorred>
      <fontitalic>N</fontitalic>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <height>523</height>
      <xloc>752</xloc>
      <yloc>16</yloc>
      <note>***	             FATURAMENTO  - SOMENTE ULTIMOS 12 MESES     	 ***

PROJETO LEAD CLIENTES






























***</note>
      <width>421</width>
    </notepad>
    <notepad>
      <backgroundcolorblue>193</backgroundcolorblue>
      <backgroundcolorgreen>228</backgroundcolorgreen>
      <backgroundcolorred>146</backgroundcolorred>
      <bordercolorblue>90</bordercolorblue>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorred>14</bordercolorred>
      <fontbold>Y</fontbold>
      <fontcolorblue>90</fontcolorblue>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorred>14</fontcolorred>
      <fontitalic>N</fontitalic>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <height>282</height>
      <xloc>1216</xloc>
      <yloc>16</yloc>
      <note>***                  	      IMPORTACAO DE ARQUIVOS    	                  .xlsx ***
















***</note>
      <width>444</width>
    </notepad>
    <notepad>
      <backgroundcolorblue>251</backgroundcolorblue>
      <backgroundcolorgreen>232</backgroundcolorgreen>
      <backgroundcolorred>201</backgroundcolorred>
      <bordercolorblue>90</bordercolorblue>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorred>14</bordercolorred>
      <fontbold>Y</fontbold>
      <fontcolorblue>90</fontcolorblue>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorred>14</fontcolorred>
      <fontitalic>N</fontitalic>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <height>525</height>
      <xloc>96</xloc>
      <yloc>560</yloc>
      <note>***	                                                                 STAGING - RAW DATA                                                                          ***
DADOS PROJETO INTEGRACAO DE DADOS FINANCEIROS

                  
























 




*** 				        </note>
      <width>623</width>
    </notepad>
  </notepads>
  <order>
    <hop>
      <from>clientes_nbs</from>
      <to>SVL</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SVL</from>
      <to>dim_clientes_nbs</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>clientes_quiver</from>
      <to>SVL 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SVL 2</from>
      <to>dim_clientes_quiver</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>clientes_dealer</from>
      <to>SVL 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SVL 3</from>
      <to>dim_clientes_dealer</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>clientes_newcon</from>
      <to>SVL 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SVL 4</from>
      <to>dim_clientes_newcon</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>dealer_faturamento</from>
      <to>dts_faturamento_dealer</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>newcon_faturamento</from>
      <to>dts_faturamento_newcon</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>quiver_faturamento</from>
      <to>dts_faturamento_quiver</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>bqtb_EmpresasGrupoBamaq</from>
      <to>dim_bandeiras_bamaq</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SCRIPT_FINANCEIRO_QUIVER</from>
      <to>dts_financeiro_quiver_pj1</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SCRIPT_FINANCEIRO_NBS</from>
      <to>dts_financeiro_nbs_pj1</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SCRIPT_FINANCEIRO_DEALERNET</from>
      <to>dts_financeiro_dealer_pj1</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SCRIPT_FINANCEIRO_NEWCON</from>
      <to>dts_financeiro_newcon_pj1</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Microsoft Excel input</from>
      <to>dts_bamaq_logos_url</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>nbs_faturamento</from>
      <to>dts_faturamento_nbs</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Microsoft Excel input</name>
    <type>ExcelInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <accept_filenames>N</accept_filenames>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <bad_line_files_extension>warning</bad_line_files_extension>
    <error_ignored>N</error_ignored>
    <error_line_files_extension>error</error_line_files_extension>
    <error_line_skipped>N</error_line_skipped>
    <fields>
      <field>
        <length>-1</length>
        <name>BANDEIRA</name>
        <precision>-1</precision>
        <repeat>N</repeat>
        <trim_type>none</trim_type>
        <type>String</type>
      </field>
      <field>
        <length>-1</length>
        <name>URL_IMAGEM</name>
        <precision>-1</precision>
        <repeat>N</repeat>
        <trim_type>none</trim_type>
        <type>String</type>
      </field>
    </fields>
    <file>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
      <name>C:\HopFilesDW\xlsx\bamaq_logos_url\bamaq_logos_url.xlsx</name>
    </file>
    <header>Y</header>
    <limit>0</limit>
    <line_number_files_extension>line</line_number_files_extension>
    <noempty>Y</noempty>
    <sheets>
      <sheet>
        <name>URLS</name>
        <startcol>0</startcol>
        <startrow>0</startrow>
      </sheet>
    </sheets>
    <spreadsheet_type>SAX_POI</spreadsheet_type>
    <stoponempty>N</stoponempty>
    <strict_types>N</strict_types>
    <attributes/>
    <GUI>
      <xloc>1312</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SCRIPT_FINANCEIRO_DEALERNET</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>DEALER</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT 
  T1.agente_cobrador
, T1.cliente
, T1.cod_cliente
, T1.cod_empresa
, T1.cod_vendedor
, T1.Data_Adesao
, T1.data_cancelamento
, T1.Data_Contemplacao
, T1.data_emissao
, T1.Data_Entrega_Bem 
, T1.data_pagamento
, T1.data_previsao_pagamento
, T1.data_vencimento
, T1.departamento
, T1.doccli
, T1.eh_devolucao
, T1.empresa
, T1.forma_pagamento
, T1.juros
, T1.lancamento_financeiro
, T1.matriz
, T1.multa
, T1.natureza_operacao
, T1.negativado
, T1.NOSSO_NUMERO
, T1.nota_fiscal_codigo
, T1.nota_fiscal_numero
, T1.nota_fiscal_serie
, T1.num_titulo
, T1.parcela
, T1.situacao_cobranca
, T1.Situacao_cota
, T1.status_titulo
, T1.sysorigem
, T1.tem_devolucao
, T1.tipo_movimento
, T1.tipo_titulo
, T1.titulo_saldo
, T1.valor_comissao
, T1.valor_devido
, T1.valor_fundo_reserva
, T1.valor_nominal_titulo
, T1.valor_seguro
, T1.valor_taxa_adminstrativa
, NULL AS valor_titulo
, T1.valorpago
, T1.vendedor
, T1.cd_grupo
, T1.grupo
, T1.cd_cota
, T1.versao
, T1.Plano_Venda
, T1.Ponto_Venda
FROM
(
SELECT
    'DEALERNETWF' as SYSORIGEM,
    T.Titulo_PessoaCod AS COD_CLIENTE,
    P.Pessoa_Nome AS CLIENTE,   
    P.Pessoa_DocIdentificador AS DOCCLI,
    E.Empresa_Codigo AS COD_EMPRESA,
    E.Empresa_Nome AS Empresa,
    EM.Empresa_Nome as MATRIZ,
    CASE T.Titulo_MovimentoFinanceiro WHEN 'P' THEN 'A PAGAR' WHEN 'R' THEN 'A RECEBER' ELSE 'DESCONHECIDO' END AS TIPO_MOVIMENTO,
    TPT.TipoTitulo_Descricao AS TIPO_TITULO,    
    CASE WHEN T.Titulo_DataVencimento >= CAST(GETDATE() AS date) THEN 'A VENCER' ELSE 'VENCIDO' END AS STATUS_TITULO,
    ISNULL(cp.CondicaoPagamento_Descricao,'Não determinada') AS FORMA_PAGAMENTO,
    ISNULL(td.TipoDocumento_Descricao,'Não informado') AS TIPO_DOCUMENTO,
    AC.AgenteCobrador_Descricao AS AGENTE_COBRADOR,
    NOP.NaturezaOperacao_Descricao AS NATUREZA_OPERACAO,
    DPTO.Departamento_Descricao AS DEPARTAMENTO,
    T.Titulo_Codigo AS LANCAMENTO_FINANCEIRO,
    T.Titulo_NossoNumero AS NOSSO_NUMERO,
    T.Titulo_Numero AS NUM_TITULO,
    T.Titulo_Parcela AS PARCELA,
    T.Titulo_DataEmissao AS DATA_EMISSAO,
    T.Titulo_DataVencimento AS DATA_VENCIMENTO,
    T.Titulo_DataPrevisaoPagamento AS DATA_PREVISAO_PAGAMENTO,
    T.Titulo_DataPagamento AS DATA_PAGAMENTO,
    0 AS VALOR_COMISSAO,
    T.Titulo_Valor AS VALOR_DEVIDO,
    NULL AS DATA_CANCELAMENTO, 
    T.Titulo_Valor AS VALOR_TITULO,
    T.Titulo_Saldo AS TITULO_SALDO,
    T.Titulo_UsuarioCodVendedor AS COD_VENDEDOR,
    U.Usuario_Nome AS VENDEDOR, 
    'N' AS EH_DEVOLUCAO,
    CASE WHEN (select TOP 1 NotaFiscal_Codigo from NotaFiscalNFReferencia where NotaFiscalNFReferencia_Tipo = 'DEV' AND NotaFiscalNFReferencia_NFCod = NF.NotaFiscal_Codigo ) is not null THEN 'S' ELSE 'N' END AS TEM_DEVOLUCAO,
    'N' AS NEGATIVADO,
    T.Titulo_NotaFiscalCod AS NOTA_FISCAL_CODIGO, 
    NF.NotaFiscal_Numero AS NOTA_FISCAL_NUMERO, 
    NF.NotaFiscal_Serie AS NOTA_FISCAL_SERIE,
    NF.NotaFiscal_Status AS SITUACAO_NF,
    NULL AS VALORPAGO, 
    NULL AS valor_fundo_reserva,
    NULL AS valor_nominal_titulo,
    NULL AS valor_seguro,
    NULL AS valor_taxa_adminstrativa,           
    NULL AS MULTA,
    NULL AS JUROS,  
    NULL AS DATA_ADESAO,
    NULL AS DATA_CONTEMPLACAO,
    NULL AS DATA_ENTREGA_BEM,
    NULL AS CD_GRUPO,
    NULL AS GRUPO, 
    NULL AS CD_COTA,
    NULL AS VERSAO,
    NULL AS PLANO_VENDA,
    NULL AS PONTO_VENDA,    
    NULL AS SITUACAO_COBRANCA,
    NULL AS SITUACAO_COTA

FROM Titulo T
INNER JOIN Pessoa P ON P.Pessoa_Codigo = T.Titulo_PessoaCod 
INNER JOIN Empresa E ON E.Empresa_Codigo = T.Titulo_EmpresaCod
INNER JOIN Empresa EM ON E.Empresa_EmpresaCodMatriz = EM.Empresa_Codigo
LEFT JOIN NotaFiscal NF ON NF.NotaFiscal_Codigo = T.Titulo_NotaFiscalCod
LEFT JOIN CondicaoPagamento cp on cp.CondicaoPagamento_Codigo = NF.NotaFiscal_CondicaoPagamentoCod
LEFT JOIN TipoDocumento td on td.TipoDocumento_Codigo = NF.NotaFiscal_TipoDocumentoCod
LEFT JOIN TipoTitulo TPT ON TPT.TipoTitulo_Codigo = T.Titulo_TipoTituloCod
LEFT JOIN AgenteCobrador AC ON AC.AgenteCobrador_Codigo = T.Titulo_AgenteCobradorCod
LEFT JOIN NaturezaOperacao NOP ON NOP.NaturezaOperacao_Codigo = T.Titulo_NaturezaOperacaoCod
LEFT JOIN Departamento DPTO ON DPTO.Departamento_Codigo = T.Titulo_DepartamentoCod
LEFT JOIN Usuario U ON U.Usuario_Codigo = T.Titulo_UsuarioCodVendedor

WHERE T.Titulo_DataEmissao between DATEADD (yy,-5,GETDATE()) AND GETDATE()
AND T.Titulo_Status NOT IN ('PAG','CAN')
and T.Titulo_MovimentoFinanceiro = 'R'
and E.Empresa_Codigo &lt;&gt; 26
) t1</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>960</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SCRIPT_FINANCEIRO_NBS</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>NBS</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT 
  T1.agente_cobrador
, T1.cliente
, T1.cod_cliente
, T1.cod_empresa
, T1.cod_vendedor
, TO_CHAR(T1.data_cancelamento, 'YYYY-MM-DD')		AS data_cancelamento
, TO_CHAR(T1.Data_Contemplacao, 'YYYY-MM-DD') 		AS Data_Contemplacao    
, TO_CHAR(T1.data_emissao, 'YYYY-MM-DD') 			AS data_emissao         
, TO_CHAR(T1.Data_Entrega_Bem, 'YYYY-MM-DD') 		AS Data_Entrega_Bem     
, TO_CHAR(T1.data_pagamento, 'YYYY-MM-DD')		AS data_pagamento      
, TO_CHAR(T1.data_previsao_pagamento, 'YYYY-MM-DD') 	AS data_previsao_pagamento 
, TO_CHAR(T1.data_vencimento, 'YYYY-MM-DD') 		AS data_vencimento       
, T1.departamento
, T1.doccli
, T1.eh_devolucao
, T1.empresa
, T1.forma_pagamento
, T1.juros
, T1.lancamento_financeiro
, T1.matriz
, T1.multa
, T1.natureza_operacao
, T1.negativado
, T1.NOSSO_NUMERO
, T1.nota_fiscal_codigo
, T1.nota_fiscal_numero
, T1.nota_fiscal_serie
, T1.num_titulo
, T1.parcela
, T1.situacao_cobranca
, T1.Situacao_cota
, T1.status_titulo
, T1.sysorigem
, T1.tem_devolucao
, T1.tipo_movimento
, T1.tipo_titulo
, T1.titulo_saldo
, T1.valor_comissao
, T1.valor_devido
, T1.valor_fundo_reserva
, T1.valor_nominal_titulo
, T1.valor_seguro
, T1.valor_taxa_adminstrativa
, NULL AS valor_titulo
, T1.valorpago
, T1.vendedor
, T1.cd_grupo
, T1.grupo
, T1.cd_cota
, T1.versao
, T1.Plano_Venda
, T1.Ponto_Venda

FROM
(

        SELECT 
            'NBS' AS SYSORIGEM, 
            'N' AS TEM_DEVOLUCAO,
            'N' AS EH_DEVOLUCAO,
            C.COD_CLIENTE AS COD_CLIENTE,
            C.NOME AS CLIENTE,    
            CASE WHEN CD.CPF IS NULL THEN CD.CGC
                 WHEN CD.CGC IS NULL THEN CD.CPF 
                 END AS DOCCLI,    
            CAST(E.COD_EMPRESA AS VARCHAR(10)) AS COD_EMPRESA,
            CAST(E.NOME AS VARCHAR(150)) AS EMPRESA,
            (SELECT NOME FROM EMPRESAS WHERE COD_EMPRESA = E.COD_MATRIZ) AS MATRIZ, 
            'A RECEBER' as TIPO_MOVIMENTO,  
            CC.NOME AS TIPO_TITULO,
            'CARTAO DE CREDITO' AS FORMA_PAGAMENTO,
            CASE WHEN CP.DATA_VENCIMENTO >= SYSDATE THEN 'A VENCER' ELSE 'VENCIDO' END AS STATUS_TITULO,
            'ATIVO' AS DESC_STATUS,
            NULL AS AGENTE_COBRADOR,
            NAT.DESCRICAO AS NATUREZA_OPERACAO, 
            DEP.DESCRICAO AS DEPARTAMENTO,
            RPAD('0',9-LENGTH(CAST(cr.COD_CONTROLE_CARTAO AS VARCHAR(9))),'0') || CAST(cr.COD_CONTROLE_CARTAO AS VARCHAR(9)) || RPAD('0',2-LENGTH(CAST(CP.PARCELA AS VARCHAR(2))),'0') || CAST(CP.PARCELA AS VARCHAR(2)) AS LANCAMENTO_FINANCEIRO,
            NULL AS NOSSO_NUMERO,   
            CR.COD_CONTROLE_CARTAO AS NUM_TITULO,
            CP.PARCELA AS PARCELA,
            NULL AS SITUACAO_COBRANCA,
            NULL AS SITUACAO_COTA,          
            NULL AS NEGATIVADO,
            NULL AS DATA_CANCELAMENTO,
            CR.DATA AS DATA_EMISSAO,
            CP.DATA_VENCIMENTO AS DATA_VENCIMENTO,
            CP.DATA_VENCIMENTO AS DATA_PREVISAO_PAGAMENTO,
            CP.DATA_BAIXA AS DATA_PAGAMENTO,
            CP.VALOR AS VALOR_TITULO,
            (CP.VALOR - CP.VALOR_DESPESA) AS VALOR_DEVIDO,
            CP.VALOR AS TITULO_SALDO,
            Cc.Comissao_Cartao AS VALOR_COMISSAO,                                                       --- ????????
            GETVENDEDORCARTAO (CR.COD_EMPRESA, CR.COD_CONTROLE_CARTAO) AS COD_VENDEDOR, 
            (SELECT NOME_COMPLETO FROM EMPRESAS_USUARIOS WHERE NOME = GETVENDEDORCARTAO (CR.COD_EMPRESA, CR.COD_CONTROLE_CARTAO)) AS VENDEDOR,
            VD.CONTROLE AS NOTA_FISCAL_CODIGO,              
            NULL AS NOTA_FISCAL_NUMERO,
            VD.SERIE AS NOTA_FISCAL_SERIE,  
            NULL AS VALORPAGO,
            NULL AS valor_fundo_reserva,
            NULL AS valor_nominal_titulo,
            NULL AS valor_seguro,
            NULL AS valor_taxa_adminstrativa,           
            NULL AS MULTA,
            NULL AS JUROS,          
            NULL AS CD_GRUPO,
            NULL AS GRUPO, 
            NULL AS CD_COTA,
            NULL AS VERSAO,
            NULL AS PLANO_VENDA,
            NULL AS PONTO_VENDA,
            NULL AS DATA_CONTEMPLACAO,
            NULL AS DATA_ENTREGA_BEM
        
        FROM CRECEBER_CARTAO CR
        
        INNER JOIN CRECEBER_CARTAO_PARC CP 
        ON 
        CR.COD_EMPRESA = CP.COD_EMPRESA AND CR.COD_CONTROLE_CARTAO = CP.COD_CONTROLE_CARTAO AND CR.DATA = CP.DATA
        
        INNER JOIN CARTAO_CREDITO CC 
        ON
        CC.COD_EMPRESA = CR.COD_EMPRESA AND CC.COD_CARTAO_CREDITO = CR.COD_CARTAO_CREDITO
        
        INNER JOIN CLIENTES C  
        ON
        C.COD_CLIENTE = CR.COD_CLIENTE 
        
        INNER JOIN CLIENTE_DIVERSO CD 
        ON
        CR.COD_CLIENTE = CD.COD_CLIENTE 
        
        INNER JOIN EMPRESAS E
        ON
        E.COD_EMPRESA = CR.COD_EMPRESA
        
        LEFT JOIN VENDAS VD
        ON
        VD.COD_EMPRESA = CR.COD_EMPRESA AND VD.CONTROLE = CR.CONTROLE_VENDA AND VD.SERIE = CR.SERIE_VENDA
        
        LEFT JOIN CONTA_CORRENTE CT
        ON 
        CT.COD_EMPRESA = CP.COD_EMPRESA AND CT.COD_CONTA_CORRENTE = CP.CONTA_BAIXA
        
        LEFT JOIN NATUREZA_RECEITA_DESPESA NAT
        ON 
        NAT.COD_NATUREZA_RECEITA_DESPESA  = CR.COD_NATUREZA_RECEITA_DESPESA AND NAT.COD_GRUPO_PC = CR.COD_GRUPO_PC

        LEFT JOIN EMPRESAS_DEPARTAMENTOS DEP
        ON
        DEP.COD_EMPRESA_DEPARTAMENTO = VD.COD_EMPRESA_DEPARTAMENTO AND DEP.COD_EMPRESA = VD.COD_EMPRESA
        
        WHERE CP.DATA_VENCIMENTO >= TO_DATE((SELECT ADD_MONTHS(SYSDATE, -12*5) FROM DUAL))
        AND CP.Conta_Baixa is Null 
         -- AND E.COD_EMPRESA IN (401)    
              
        
        UNION ALL   
              
        
        SELECT DISTINCT
            'NBS' as SYSORIGEM, 
            NVL(FR.TEM_DEVOLUCAO,'N') AS TEM_DEVOLUCAO,
            NVL(FR.EH_DEVOLUCAO,'N') AS EH_DEVOLUCAO,
          C.COD_CLIENTE AS COD_CLIENTE,
            C.NOME AS CLIENTE,    
            CASE WHEN CD.CPF IS NULL THEN CD.CGC
                 WHEN CD.CGC IS NULL THEN CD.CPF 
                 END AS DOCCLI,    
            CAST(E.COD_EMPRESA AS VARCHAR(10)) AS COD_EMPRESA,
            CAST(E.NOME AS VARCHAR(150)) AS EMPRESA,
            (SELECT NOME FROM EMPRESAS WHERE COD_EMPRESA = E.COD_MATRIZ) AS MATRIZ, 
            'A RECEBER' as TIPO_MOVIMENTO,  
            FP.DESCRICAO AS TIPO_TITULO,
            fc.DESCRICAO  AS FORMA_PAGAMENTO,
            CASE WHEN CR.DATA_VENCIMENTO >= SYSDATE THEN 'A VENCER' ELSE 'VENCIDO' END AS STATUS_TITULO,
            SF.DESCRICAO AS DESC_STATUS,
            NULL AS AGENTE_COBRADOR,
            nrd.DESCRICAO AS NATUREZA_OPERACAO, 
            DEP.DESCRICAO AS DEPARTAMENTO,
            RPAD('0',9-LENGTH(CAST(cr.NR_FATURA AS VARCHAR(9))),'0') || CAST(cr.NR_FATURA AS VARCHAR(9)) || RPAD('0',2-LENGTH(CAST(cr.PARCELA AS VARCHAR(2))),'0') || CAST(cr.PARCELA AS VARCHAR(2)) AS LANCAMENTO_FINANCEIRO,
            TO_CHAR(NVL(CR.NOSSO_NUMERO,'')) || '-' ||  NVL(CR.DG_NOSSO_NUMERO,'') AS NOSSO_NUMERO, 
            CR.NR_FATURA AS NUM_TITULO,
            CR.PARCELA AS PARCELA,
            NULL AS SITUACAO_COBRANCA,
            NULL AS SITUACAO_COTA,
            NVL(CR.NEGATIVADO,'N') as NEGATIVADO,
            FR.DATA_CANCEL AS DATA_CANCELAMENTO,
            CR.DATA_EMISSAO AS DATA_EMISSAO,
            CR.DATA_VENCIMENTO AS DATA_VENCIMENTO,
            CR.DATA_VENCIMENTO AS DATA_PREVISAO_PAGAMENTO,
            CR.DATA_BAIXA AS DATA_PAGAMENTO,
            CR.VALOR_PARCELA AS VALOR_TITULO,
            CR.SALDO_PARCELA AS VALOR_DEVIDO,
            --V.TOTAL_NOTA, 
            CR.SALDO_PARCELA AS TITULO_SALDO,
            CR.VALOR_COMISSAO  AS VALOR_COMISSAO,
            EU.NOME AS COD_VENDEDOR,
            EU.NOME_COMPLETO AS VENDEDOR,
            cr.NR_FATURA AS NOTA_FISCAL_CODIGO,
            
            GETNUMERONF(CR.COD_EMPRESA, CR.COD_TIPO_FATURA, CR.NR_FATURA, CR.DATA_EMISSAO, 'S') || ' - '  || GETNUMERONF(CR.COD_EMPRESA, CR.COD_TIPO_FATURA, CR.NR_FATURA, CR.DATA_EMISSAO,'N','S') AS NOTA_FISCAL_NUMERO,
                         
            NULL AS NOTA_FISCAL_SERIE,              
            NULL AS VALORPAGO,
            NULL AS valor_fundo_reserva,
            NULL AS valor_nominal_titulo,
            NULL AS valor_seguro,
            NULL AS valor_taxa_adminstrativa,           
            NULL AS MULTA,
            NULL AS JUROS,          
            NULL AS CD_GRUPO,
            NULL AS GRUPO, 
            NULL AS CD_COTA,
            NULL AS VERSAO,
            NULL AS PLANO_VENDA,
            NULL AS PONTO_VENDA,    
            NULL AS DATA_CONTEMPLACAO,
            NULL AS DATA_ENTREGA_BEM
            
        FROM CONTAS_RECEBER CR 
        
        INNER JOIN FATURA_RECEBER FR  
        ON 
        CR.NR_FATURA = FR.NR_FATURA AND CR.COD_EMPRESA = FR.COD_EMPRESA AND CR.COD_TIPO_FATURA = FR.COD_TIPO_FATURA AND CR.DATA_EMISSAO = FR.DATA_EMISSAO 
        
        LEFT JOIN VW_FATURA_RECEBER_DETALHE FRD 
        ON 
        frd.COD_EMPRESA = CR.COD_EMPRESA AND frd.NR_FATURA = fr.NR_FATURA AND FRD.COD_TIPO_FATURA = FR.COD_TIPO_FATURA AND FR.DATA_EMISSAO = CR.DATA_EMISSAO 
        
        INNER JOIN CLIENTES C 
        ON 
        C.COD_CLIENTE = FR.COD_CLIENTE 
        
        LEFT JOIN FORMA_COBRANCA FC 
        ON 
        CR.COD_EMPRESA_FC = FC.COD_EMPRESA AND CR.COD_FORMA_COBRANCA = FC.COD_FORMA_COBRANCA
        
        LEFT JOIN GRUPO_FORMA_COBRANCA GF 
        ON 
        FC.COD_MATRIZ  = GF.COD_MATRIZ AND FC.COD_GR_FORMA_COBRANCA = GF.COD_GR_FORMA_COBRANCA
        
        LEFT JOIN CLIENTE_DIVERSO CD 
        ON 
        CD.COD_CLIENTE = C.COD_CLIENTE
        
        LEFT JOIN EMPRESAS E 
        ON 
        E.COD_EMPRESA = FR.COD_EMPRESA      
        
        LEFT JOIN FORMA_PGTO FP 
        ON 
        FP.COD_EMPRESA = CR.COD_EMPRESA AND FP.COD_FORMA_PGTO = CR.COD_FORMA_PGTO 

        LEFT JOIN EMPRESAS_DEPARTAMENTOS DEP
        ON
        DEP.COD_EMPRESA_DEPARTAMENTO = FP.COD_EMPRESA_DEPARTAMENTO AND DEP.COD_EMPRESA = FC.COD_EMPRESA

        
        LEFT JOIN FORMA_COBRANCA FC 
        ON 
        FC.COD_EMPRESA = CR.COD_EMPRESA AND FC.COD_FORMA_COBRANCA = CR.COD_FORMA_PGTO
        
        LEFT JOIN NATUREZA_RECEITA_DESPESA NRD
        ON 
        NRD.COD_NATUREZA_RECEITA_DESPESA  = FR.COD_NATUREZA_RECEITA_DESPESA  AND NRD.COD_GRUPO_PC = FR.COD_GRUPO_PC 
        
        LEFT JOIN EMPRESAS_USUARIOS EU 
        ON 
        EU.NOME = FR.USUARIO AND EU.COD_EMPRESA = FR.COD_EMPRESA 
        
        LEFT JOIN STATUS_FINANCEIRO SF
        ON 
        FR.COD_STATUS = SF.COD_STATUS
        
        WHERE   CR.DATA_BAIXA IS NULL
                AND FR.COD_STATUS = 0
                AND CR.TIPO_CARTEIRA = 0 
                AND CR.DATA_VENCIMENTO  >= TO_DATE((SELECT ADD_MONTHS(SYSDATE, -12*5) FROM DUAL))
        --      AND CR.COD_EMPRESA IN ('400','401','402')
) t1</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>752</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SCRIPT_FINANCEIRO_NEWCON</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>NEWCON</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>-- LISTA DAS PARCELAS PAGAS NOS ULTIMOS 5 ANOS
SELECT 
  T1.agente_cobrador
, T1.cliente
, T1.cod_cliente
, T1.cod_empresa
, T1.cod_vendedor
, T1.Data_Adesao
, T1.data_cancelamento
, T1.Data_Contemplacao
, T1.data_emissao
, T1.Data_Entrega_Bem 
, T1.data_pagamento
, T1.data_previsao_pagamento
, T1.data_vencimento
, T1.departamento
, T1.doccli
, T1.eh_devolucao
, T1.empresa
, T1.forma_pagamento
, T1.juros
, T1.lancamento_financeiro
, T1.matriz
, T1.multa
, T1.natureza_operacao
, T1.negativado
, T1.NOSSO_NUMERO
, T1.nota_fiscal_codigo
, T1.nota_fiscal_numero
, T1.nota_fiscal_serie
, T1.num_titulo
, T1.parcela
, T1.situacao_cobranca
, T1.Situacao_cota
, T1.status_titulo
, T1.sysorigem
, T1.tem_devolucao
, T1.tipo_movimento
, T1.tipo_titulo
, T1.titulo_saldo
, T1.valor_comissao
, T1.valor_devido
, T1.valor_fundo_reserva
, T1.valor_nominal_titulo
, T1.valor_seguro
, T1.valor_fundo_comum
, T1.valor_taxa_adminstrativa
, NULL AS valor_titulo
, T1.valorpago
, T1.vendedor
, T1.cd_grupo
, T1.grupo
, T1.cd_cota
, T1.versao
, T1.Plano_Venda
, T1.Ponto_Venda
FROM
(
-- LISTA DAS PARCELAS EM ABERTO, VENCIDAS E A VENCER NO PRÓXIMO MÊS
 SELECT
    'NEWCON' AS SYSORIGEM, 
    CORCC023.ID_Pessoa as COD_CLIENTE,
    CORCC023.NM_Pessoa as CLIENTE,
    CORCC023.CD_Inscricao_Nacional as DOCCLI,
    '1' AS COD_EMPRESA,
    'BAMAQ CONSÓRCIO' AS EMPRESA,
    'BAMAQ CONSÓRCIO' AS MATRIZ,
    'CONTAS A RECEBER' AS TIPO_MOVIMENTO,
    CONCC025.NM_Tipo_Documento AS TIPO_TITULO,
    CORCC036.NM_Forma_Recebimento AS FORMA_PAGAMENTO,
    CASE WHEN A.DT_VENCIMENTO >= CAST(GETDATE() AS DATE) THEN 'A VENCER' ELSE 'VENCIDO' END AS STATUS_TITULO,
    CONFI002.NM_Agente AS AGENTE_COBRADOR,  
    'VENDA DE CONSÓRCIO'  AS NATUREZA_OPERACAO,
    CONVE001.NM_Fantasia AS DEPARTAMENTO,
    NULL AS LANCAMENTO_FINANCEIRO,
    CONCO021I.Nosso_Numero AS NOSSO_NUMERO, 
    REPLICATE('0',(10-LEN(CAST(CONVE002.id_cota AS varchar(10))))) + CAST(CONVE002.id_cota AS varchar(10)) +  + ' - ' + CAST(a.NO_Parcela AS VARCHAR(3))  AS NUM_TITULO,
    A.NO_PARCELA AS PARCELA,
    NULL AS NEGATIVADO, 
    NULL AS DATA_CANCELAMENTO,
    NULL AS DATA_EMISSAO,
    A.DT_VENCIMENTO AS DATA_VENCIMENTO,
    NULL AS DATA_PAGAMENTO,
    A.DT_VENCIMENTO AS DATA_PREVISAO_PAGAMENTO,
    A.VL_LANCAMENTO AS VALOR_NOMINAL_TITULO,
    A.VL_MU AS MULTA,
    A.VL_JU AS JUROS,
    (A.VL_LANCAMENTO + A.VL_MJ) AS VALOR_DEVIDO,
    CASE WHEN A.NO_PARCELA = (SELECT MAX(NO_Parcela) FROM dbo.fn_dsCoAvisoCobranca(CONVE002.ID_Cota, CORCC000.DT_Base_Processamento, CORCC000.DT_Base_Processamento)) 
        THEN (SELECT VL_Diferenca FROM fn_dsVeVLSaldoDevedor(CONVE002.ID_Cota,  CORCC000.DT_Base_Processamento,  0))
        ELSE 0 
    END AS TITULO_SALDO,
    0 AS VALORPAGO,
    PA.VL_FC AS VALOR_FUNDO_COMUM,
    PA.VL_FR AS VALOR_FUNDO_RESERVA,
    PA.VL_TA AS VALOR_TAXA_ADMINSTRATIVA,
    PA.VL_SG AS VALOR_SEGURO,
    0 AS VALOR_COMISSAO,
    'N' AS TEM_DEVOLUCAO,
    'N' AS EH_DEVOLUCAO,
    CONVE002.ID_Comissionado AS COD_VENDEDOR,
    CONVE014.NM_Fantasia AS VENDEDOR,
    CASE CONVE002D.ST_CONTEMPLACAO WHEN 'S' THEN 'CONTEMPLADA' WHEN 'N' THEN 'NÃO CONTEMPLADA' WHEN 'S' THEN 'LANCE' END AS SITUACAO_COTA,
    NULL AS NOTA_FISCAL_CODIGO, 
    NULL AS NOTA_FISCAL_NUMERO, 
    NULL AS NOTA_FISCAL_SERIE,
    CONCO003.NM_Situacao_Cobranca AS SITUACAO_COBRANCA,
    CONGR001.CD_GRUPO,
    CONGR001.NM_CARACTERISTICA AS GRUPO,
    CONVE002.CD_COTA,
    CONVE002.VERSAO,
    CONVE041.NM_PLANO_VENDA as PLANO_VENDA,
    conve001.NM_FANTASIA as PONTO_VENDA,
    CONCC030.DT_ADESAO as DATA_ADESAO,
    CONVE002D.DT_CONTEMPLACAO_CONCP016 as DATA_CONTEMPLACAO,
    CONVE002D.DT_ENTREGA_BEM as DATA_ENTREGA_BEM
FROM CORCC000  
CROSS JOIN CONVE002  
CROSS APPLY dbo.fn_dsCoAvisoCobranca(CONVE002.ID_Cota, CORCC000.DT_Base_Processamento, CORCC000.DT_Base_Processamento) AS a  
CROSS APPLY fn_dsAtValorParcela (CONVE002.ID_Cota,A.NO_PARCELA, CORCC000.DT_Base_Processamento) PA

INNER JOIN CORCC023 -- PESSOA
ON 
CORCC023.ID_Pessoa = CONVE002.ID_Pessoa

INNER JOIN CONCC030
ON
CONCC030.ID_CONCC030 = CONVE002.ID_CONCC030

LEFT JOIN CONCC025 -- TIPO DE DOCUMENTO
ON 
CONCC025.ID_Tipo_Documento = CONCC030.ID_Tipo_Documento

LEFT JOIN CONVE001  -- CADASTRO DA EQUIPE DE BEM
ON
CONVE001.ID_Ponto_Venda = CONVE002.ID_Ponto_Venda

LEFT JOIN CONCO021A 
ON
CONCO021A.ID_Cota = CONVE002.ID_Cota AND CONCO021A.ID_Assembleia = A.ID_Assembleia

LEFT JOIN CONCO021I 
ON
CONCO021A.ID_CONCO021I = CONCO021I.ID_CONCO021I

LEFT JOIN CONFI002
ON 
CONFI002.ID_Agente = CONCO021I.ID_Agente

LEFT JOIN CONVE009  -- CADASTRO DA EQUIPE DE BEM
ON
CONVE009.ID_Equipe_Venda = CONCC030.ID_Equipe_Venda

LEFT JOIN CORCC036 -- CADASTRO DA FORMA DE EQUIPE
ON
CONVE001.ID_Forma_Recebimento = CORCC036.ID_Forma_Recebimento

LEFT JOIN CONVE014
ON
CONVE014.ID_Comissionado = CONVE002.ID_Comissionado

LEFT JOIN CONVE002D
ON
CONVE002D.ID_COTA = CONVE002.ID_Cota

LEFT JOIN CONGR001
ON
CONVE002.ID_GRUPO = CONGR001.ID_GRUPO

LEFT JOIN CONVE041
ON
CONVE041.ID_Plano_Venda = CONVE002.ID_Plano_Venda

LEFT JOIN CONCO003 
ON
CONCO003.ID_Situacao_Cobranca = CONVE002D.ID_Situacao_Cobranca

WHERE CONVE002.Versao = 0
AND A.DT_Vencimento >= DATEADD(yy,-5,getdate())
--AND CONVE002.ID_Cota = 46850
) T1</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>848</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SCRIPT_FINANCEIRO_QUIVER</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>QUIVER</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT 
  T1.agente_cobrador
, T1.cliente
, T1.cod_cliente
, T1.cod_empresa
, T1.cod_vendedor
, T1.data_cancelamento
, T1.data_emissao
, T1.data_pagamento
, T1.data_previsao_pagamento
, T1.data_vencimento
, T1.departamento
, T1.doccli
, T1.eh_devolucao
, T1.empresa
, T1.forma_pagamento
, T1.juros
, T1.lancamento_financeiro
, T1.matriz
, T1.multa
, T1.natureza_operacao
, T1.negativado
, T1.NOSSO_NUMERO
, T1.nota_fiscal_codigo
, T1.nota_fiscal_numero
, T1.nota_fiscal_serie
, T1.num_titulo
, T1.parcela
, T1.status_titulo
, T1.sysorigem
, T1.tem_devolucao
, T1.tipo_movimento
, T1.tipo_titulo
, T1.titulo_saldo
, T1.valor_comissao
, T1.valor_devido
, T1.valor_fundo_reserva
, T1.valor_nominal_titulo
, T1.valor_seguro
, T1.valor_taxa_adminstrativa
, NULL AS valor_titulo
, T1.valorpago
, T1.vendedor

FROM
(
SELECT 
	'Quiver' as SYSORIGEM,
	C.Cliente AS COD_CLIENTE,
	C.Nome AS CLIENTE,	
	c.Cgc_cpf AS DOCCLI,
	div.Divisao AS COD_EMPRESA,
	DIV.Nome as Empresa,
	'CGF-Seguros' as MATRIZ,
	'A RECEBER' as TIPO_MOVIMENTO,
	FR.Descricao AS TIPO_TITULO,
	CASE d.Situacao 
		WHEN 1 THEN 'Ativa'
		WHEN 2 THEN 'Cancelada'
		WHEN 3 THEN 'Suspensa'
		WHEN 4 THEN 'Renovada'
		WHEN 5 THEN 'Vencida' 
		WHEN 6 THEN 'Perda Total' 
		ELSE 'Desconhecida'
	END AS STATUS_TITULO,
	MP.Descricao AS FORMA_PAGAMENTO, 
	TD.Descricao AS TIPO_DOCUMENTO,
	SG.Nome AS AGENTE_COBRADOR,
	NULL AS NATUREZA_OPERACAO,				-- ?
	DIV.Nome AS DEPARTAMENTO,		
	CO.Parc_comissao AS LANCAMENTO_FINANCEIRO,   
	NULL AS NOSSO_NUMERO,
	d.Proposta AS NUM_TITULO,
	CR.PARCELA AS PARCELA,
	d.DATA_EMISSAO AS DATA_EMISSAO,
	CR.Data_vencimento AS DATA_VENCIMENTO,
	CR.Data_vencimento AS DATA_PREVISAO_PAGAMENTO,
	CR.Data_pagamento AS DATA_PAGAMENTO,
	NULL AS VALORPAGO,				--?
	NULL AS JUROS,
	NULL AS MULTA,
	NULL AS VALOR_COMISSAO,
	CO.Valor AS VALOR_DEVIDO,
	0 AS VALOR_FUNDO_RESERVA,
	0 AS VALOR_NOMINAL_TITULO,
	0 AS VALOR_SEGURO,
	0 AS VALOR_TAXA_ADMINSTRATIVA,
	NULL AS DATA_CANCELAMENTO, --?
	CO.Valor AS VALOR_TITULO,
	CO.Valor AS TITULO_SALDO,
	GH.Grupo_hierarquico AS COD_VENDEDOR,
	GH.NOME AS VENDEDOR, 
	NULL AS EH_DEVOLUCAO,
	NULL AS TEM_DEVOLUCAO,
	NULL AS NEGATIVADO,
	NULL AS NOTA_FISCAL_CODIGO, 
	NULL AS NOTA_FISCAL_NUMERO, 
	NULL AS NOTA_FISCAL_SERIE,
	NULL AS SITUACAO_NF

FROM TABELA_DOCSPARCSCOM co

INNER JOIN TABELA_DOCSPARCSPREM CR 
(nolock) ON 
CR.Documento = CO.Documento AND CR.Alteracao = CO.Alteracao and CR.Parcela = CO.Parcela

INNER JOIN Tabela_DocsRepasses DR
(nolock) ON 
co.Documento = dr.Documento AND co.Alteracao = dr.Alteracao  

INNER JOIN Tabela_Documentos d
(nolock) ON
Co.Documento = d.Documento and Co.Alteracao = d.Alteracao 

INNER JOIN TABELA_CLIENTES C 
(nolock) ON 
D.CLIENTE = C.CLIENTE

INNER JOIN Tabela_NiveisHierarq NH 
(nolock) ON 
NH.Nivel = DR.Nivel  

LEFT JOIN TABELA_TIPOSDOCEMISS TD 
ON
TD.TIPO_DOCUMENTO = D.TIPO_DOCUMENTO

LEFT JOIN TABELA_MEIOSPAGTO MP 
ON
MP.Meio_pagto = CR.Meio_pagto

LEFT JOIN TABELA_DIVISOES DIV 
ON
DIV.Divisao =  DR.Divisao

LEFT JOIN TABELA_SEGURADORAS SG 
ON 
SG.Seguradora = d.Seguradora

LEFT JOIN TABELA_GRUPOSHIERARQ GH
ON 
GH.Grupo_hierarquico = d.Grupo_hierarquico

LEFT JOIN TABELA_FORMASRECCOM FR
ON 
FR.Forma_recebimento = d.Forma_recebimento

WHERE	DR.Nivel = 1 
		AND NH.Descricao = 'CORRETORA' 
		AND CO.Operacao = 'D' 
		AND D.Comissao_quitada = 1 
		AND CO.Data_Operacao BETWEEN DATEADD(YY,-5,GETDATE()) AND GETDATE()
		AND CR.Data_pagamento IS NULL
		AND d.Situacao not in (2,3) 
		--AND CO.Documento = 130725
) t1


--select * from TABELA_DOCSPARCSCOM WHERE documento IN (143309)  AND ALTERACAO = 0 ORDER BY Parcela
--select * from [Tabela_DocsParcsPrem] where Documento in (143404,139953,134893) AND CAST(Data_pagamento AS DATE) between '2023-09-01' and '2023-09-12'
--SELECT * FROM [Tabela_DocsParcsPrem] Where Documento in (143122,135733) -- aqui tem campos de boleto, mas tudo vazio. 
--select * from Tabela_Documentos where Proposta in (23773) and Data_proposta  between '2023-09-01' and '2023-09-12'
--select * from TABELA_DOCSPARCSCOM WHERE documento IN (143122,135733)
--select * from Tabela_DocsRepasses
--select top 10 * from TABELA_CLIENTES 
--select top 10 * from TABELA_SEGURADORAS
--select top 10 * from TABELA_TIPOSDOCEMISS
--select top 10 * from TABELA_SUBTIPOSDOC
--select top 10 * from TABELA_GRUPOSHIERARQ 
-- SELECT * FROM TABELA_DIVISOES
---select * from [dbo].[Tabela_TiposSitItens]
--SELECT * FROM Tabela_DocsParcsPrem WHERE DOCUMENTO = '130725'

/*



select --c.*, 
d.documento, d.proposta, d.Comissao_quitada, cr.Data_Vencimento, CO.* 
from TABELA_DOCSPARCSCOM co
inner join TABELA_DOCSPARCSPREM cr on cr.Documento = co.Documento and cr.Alteracao = co.Alteracao and cr.Parcela = co.Parcela
inner JOIN Tabela_DocsRepasses DR (nolock) ON co.Documento = dr.Documento AND co.Alteracao = dr.Alteracao 
inner JOIN Tabela_Documentos d on d.Documento = co.Documento and d.Alteracao = co.Alteracao 
inner JOIN TABELA_CLIENTES C  (nolock) ON  D.CLIENTE = C.CLIENTE
where 
--cast(cr.Data_vencimento as date) BETWEEN '2023-09-01' AND '2023-09-22' and
co.Data_operacao BETWEEN '2023-09-01' AND '2023-09-22' and
co.Operacao = 'D' and
DR.Nivel = 1 AND 
cr.Data_pagamento is null and 
d.Comissao_quitada = 1 and
d.Situacao not in (2,3) 
--d.Documento = 138065
--d.Proposta = 14807
order by 1

*/

/*
1) Como obter a natureza da operação para os titulos?
2) Como obter boleta do titulos?
3) Como obter a NF do titulos?
*/</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>656</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SVL</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>SYSORIGEM</name>
        <rename/>
      </field>
      <field>
        <name>CODCLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>CLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>TIPOENDERECO</name>
        <rename/>
      </field>
      <field>
        <name>ENDERECOPRINCIPAL</name>
        <rename/>
      </field>
      <field>
        <name>UF</name>
        <rename/>
      </field>
      <field>
        <name>CIDADE</name>
        <rename/>
      </field>
      <field>
        <name>BAIRRO</name>
        <rename/>
      </field>
      <field>
        <name>LOGRADOURO</name>
        <rename/>
      </field>
      <field>
        <name>NUMERO</name>
        <rename/>
      </field>
      <field>
        <name>COMPLEMENTO</name>
        <rename/>
      </field>
      <field>
        <name>CEP</name>
        <rename/>
      </field>
      <field>
        <name>EMAIL</name>
        <rename/>
      </field>
      <field>
        <name>TELL</name>
        <rename/>
      </field>
      <field>
        <name>CELL</name>
        <rename/>
      </field>
      <field>
        <name>TIPOFJ</name>
        <rename/>
      </field>
      <field>
        <name>DOCCLI</name>
        <rename/>
      </field>
      <field>
        <name>DATA_CADASTRO</name>
        <rename/>
      </field>
      <field>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename/>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>SYSORIGEM</name>
        <rename>SYSORIGEM</rename>
        <type>None</type>
        <length>32</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CODCLIENTE</name>
        <rename>CODCLIENTE</rename>
        <type>None</type>
        <length>38</length>
        <precision>0</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CLIENTE</name>
        <rename>CLIENTE</rename>
        <type>None</type>
        <length>150</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPOENDERECO</name>
        <rename>TIPOENDERECO</rename>
        <type>None</type>
        <length>11</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>ENDERECOPRINCIPAL</name>
        <rename>ENDERECOPRINCIPAL</rename>
        <type>None</type>
        <length>1</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>UF</name>
        <rename>UF</rename>
        <type>None</type>
        <length>2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CIDADE</name>
        <rename>CIDADE</rename>
        <type>None</type>
        <length>72</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>BAIRRO</name>
        <rename>BAIRRO</rename>
        <type>None</type>
        <length>30</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>LOGRADOURO</name>
        <rename>LOGRADOURO</rename>
        <type>None</type>
        <length>50</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>NUMERO</name>
        <rename>NUMERO</rename>
        <type>None</type>
        <length>5</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>COMPLEMENTO</name>
        <rename>COMPLEMENTO</rename>
        <type>None</type>
        <length>40</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CEP</name>
        <rename>CEP</rename>
        <type>None</type>
        <length>8</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>EMAIL</name>
        <rename>EMAIL</rename>
        <type>None</type>
        <length>50</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TELL</name>
        <rename>TELL</rename>
        <type>None</type>
        <length>13</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CELL</name>
        <rename>CELL</rename>
        <type>None</type>
        <length>13</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPOFJ</name>
        <rename>TIPOFJ</rename>
        <type>None</type>
        <length>8</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DOCCLI</name>
        <rename>DOCCLI</rename>
        <type>None</type>
        <length>18</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_CADASTRO</name>
        <rename>DATA_CADASTRO</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename>DATA_ULTIMA_ATUALIZACAO</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <GUI>
      <xloc>384</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SVL 2</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>SYSORIGEM</name>
        <rename/>
      </field>
      <field>
        <name>CODCLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>CLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>TIPO_ENDERECO</name>
        <rename/>
      </field>
      <field>
        <name>ENDERECOPRINCIPAL</name>
        <rename/>
      </field>
      <field>
        <name>UF</name>
        <rename/>
      </field>
      <field>
        <name>CIDADE</name>
        <rename/>
      </field>
      <field>
        <name>BAIRRO</name>
        <rename/>
      </field>
      <field>
        <name>LOGRADOURO</name>
        <rename/>
      </field>
      <field>
        <name>NUMERO</name>
        <rename/>
      </field>
      <field>
        <name>COMPLEMENTO</name>
        <rename/>
      </field>
      <field>
        <name>CEP</name>
        <rename/>
      </field>
      <field>
        <name>EMAIL</name>
        <rename/>
      </field>
      <field>
        <name>TELL</name>
        <rename/>
      </field>
      <field>
        <name>CELL</name>
        <rename/>
      </field>
      <field>
        <name>TIPOFJ</name>
        <rename/>
      </field>
      <field>
        <name>DOCCLI</name>
        <rename/>
      </field>
      <field>
        <name>DATA_CADASTRO</name>
        <rename/>
      </field>
      <field>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename/>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>SYSORIGEM</name>
        <rename>SYSORIGEM</rename>
        <type>None</type>
        <length>6</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CODCLIENTE</name>
        <rename>CODCLIENTE</rename>
        <type>None</type>
        <length>15</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CLIENTE</name>
        <rename>CLIENTE</rename>
        <type>None</type>
        <length>100</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPO_ENDERECO</name>
        <rename>TIPO_ENDERECO</rename>
        <type>None</type>
        <length>30</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>ENDERECOPRINCIPAL</name>
        <rename>ENDERECOPRINCIPAL</rename>
        <type>None</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>UF</name>
        <rename>UF</rename>
        <type>None</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CIDADE</name>
        <rename>CIDADE</rename>
        <type>None</type>
        <length>40</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>BAIRRO</name>
        <rename>BAIRRO</rename>
        <type>None</type>
        <length>30</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>LOGRADOURO</name>
        <rename>LOGRADOURO</rename>
        <type>None</type>
        <length>50</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>NUMERO</name>
        <rename>NUMERO</rename>
        <type>None</type>
        <length>10</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>COMPLEMENTO</name>
        <rename>COMPLEMENTO</rename>
        <type>None</type>
        <length>20</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CEP</name>
        <rename>CEP</rename>
        <type>None</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>EMAIL</name>
        <rename>EMAIL</rename>
        <type>None</type>
        <length>65</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TELL</name>
        <rename>TELL</rename>
        <type>None</type>
        <length>17</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CELL</name>
        <rename>CELL</rename>
        <type>None</type>
        <length>17</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPOFJ</name>
        <rename>TIPOFJ</rename>
        <type>None</type>
        <length>8</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DOCCLI</name>
        <rename>DOCCLI</rename>
        <type>None</type>
        <length>19</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_CADASTRO</name>
        <rename>DATA_CADASTRO</rename>
        <type>Date</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename>DATA_ULTIMA_ATUALIZACAO</rename>
        <type>Date</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <GUI>
      <xloc>384</xloc>
      <yloc>192</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SVL 3</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>SYSORIGEM</name>
        <rename/>
      </field>
      <field>
        <name>CODCLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>CLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>TIPOENDERECO</name>
        <rename/>
      </field>
      <field>
        <name>PRINCIPAL</name>
        <rename/>
      </field>
      <field>
        <name>UF</name>
        <rename/>
      </field>
      <field>
        <name>CIDADE</name>
        <rename/>
      </field>
      <field>
        <name>BAIRRO</name>
        <rename/>
      </field>
      <field>
        <name>LOGRADOURO</name>
        <rename/>
      </field>
      <field>
        <name>NUMERO</name>
        <rename/>
      </field>
      <field>
        <name>COMPLEMENTO</name>
        <rename/>
      </field>
      <field>
        <name>CEP</name>
        <rename/>
      </field>
      <field>
        <name>EMAIL</name>
        <rename/>
      </field>
      <field>
        <name>TELL</name>
        <rename/>
      </field>
      <field>
        <name>CELL</name>
        <rename/>
      </field>
      <field>
        <name>TIPOFJ</name>
        <rename/>
      </field>
      <field>
        <name>DOCCLI</name>
        <rename/>
      </field>
      <field>
        <name>DATA_CADASTRO</name>
        <rename/>
      </field>
      <field>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename/>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>SYSORIGEM</name>
        <rename>SYSORIGEM</rename>
        <type>None</type>
        <length>6</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CODCLIENTE</name>
        <rename>CODCLIENTE</rename>
        <type>None</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CLIENTE</name>
        <rename>CLIENTE</rename>
        <type>None</type>
        <length>60</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPOENDERECO</name>
        <rename>TIPOENDERECO</rename>
        <type>None</type>
        <length>50</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>PRINCIPAL</name>
        <rename>PRINCIPAL</rename>
        <type>None</type>
        <length>1</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>UF</name>
        <rename>UF</rename>
        <type>None</type>
        <length>2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CIDADE</name>
        <rename>CIDADE</rename>
        <type>None</type>
        <length>60</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>BAIRRO</name>
        <rename>BAIRRO</rename>
        <type>None</type>
        <length>60</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>LOGRADOURO</name>
        <rename>LOGRADOURO</rename>
        <type>None</type>
        <length>100</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>NUMERO</name>
        <rename>NUMERO</rename>
        <type>None</type>
        <length>10</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>COMPLEMENTO</name>
        <rename>COMPLEMENTO</rename>
        <type>None</type>
        <length>60</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CEP</name>
        <rename>CEP</rename>
        <type>None</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>EMAIL</name>
        <rename>EMAIL</rename>
        <type>None</type>
        <length>150</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TELL</name>
        <rename>TELL</rename>
        <type>None</type>
        <length>20</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CELL</name>
        <rename>CELL</rename>
        <type>None</type>
        <length>20</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPOFJ</name>
        <rename>TIPOFJ</rename>
        <type>None</type>
        <length>8</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DOCCLI</name>
        <rename>DOCCLI</rename>
        <type>None</type>
        <length>20</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_CADASTRO</name>
        <rename>DATA_CADASTRO</rename>
        <type>Date</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename>DATA_ULTIMA_ATUALIZACAO</rename>
        <type>Date</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <GUI>
      <xloc>384</xloc>
      <yloc>288</yloc>
    </GUI>
  </transform>
  <transform>
    <name>SVL 4</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>SYSORIGEM</name>
        <rename/>
      </field>
      <field>
        <name>CODCLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>CLIENTE</name>
        <rename/>
      </field>
      <field>
        <name>DOCCLI</name>
        <rename/>
      </field>
      <field>
        <name>TIPOFJ</name>
        <rename/>
      </field>
      <field>
        <name>TIPOENDERECO</name>
        <rename/>
      </field>
      <field>
        <name>ENDERECOPRINCIPAL</name>
        <rename/>
      </field>
      <field>
        <name>CIDADE</name>
        <rename/>
      </field>
      <field>
        <name>UF</name>
        <rename/>
      </field>
      <field>
        <name>BAIRRO</name>
        <rename/>
      </field>
      <field>
        <name>LOGRADOURO</name>
        <rename/>
      </field>
      <field>
        <name>NUMERO</name>
        <rename/>
      </field>
      <field>
        <name>COMPLEMENTO</name>
        <rename/>
      </field>
      <field>
        <name>CEP</name>
        <rename/>
      </field>
      <field>
        <name>EMAIL</name>
        <rename/>
      </field>
      <field>
        <name>CELL</name>
        <rename/>
      </field>
      <field>
        <name>TELL</name>
        <rename/>
      </field>
      <field>
        <name>DATA_CADASTRO</name>
        <rename/>
      </field>
      <field>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename/>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>SYSORIGEM</name>
        <rename>SYSORIGEM</rename>
        <type>None</type>
        <length>6</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CODCLIENTE</name>
        <rename>CODCLIENTE</rename>
        <type>None</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CLIENTE</name>
        <rename>CLIENTE</rename>
        <type>None</type>
        <length>80</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DOCCLI</name>
        <rename>DOCCLI</rename>
        <type>None</type>
        <length>14</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPOFJ</name>
        <rename>TIPOFJ</rename>
        <type>None</type>
        <length>8</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TIPOENDERECO</name>
        <rename>TIPOENDERECO</rename>
        <type>None</type>
        <length>30</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>ENDERECOPRINCIPAL</name>
        <rename>ENDERECOPRINCIPAL</rename>
        <type>None</type>
        <length>1</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CIDADE</name>
        <rename>CIDADE</rename>
        <type>None</type>
        <length>40</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>UF</name>
        <rename>UF</rename>
        <type>None</type>
        <length>2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>BAIRRO</name>
        <rename>BAIRRO</rename>
        <type>None</type>
        <length>30</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>LOGRADOURO</name>
        <rename>LOGRADOURO</rename>
        <type>None</type>
        <length>80</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>NUMERO</name>
        <rename>NUMERO</rename>
        <type>None</type>
        <length>10</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>COMPLEMENTO</name>
        <rename>COMPLEMENTO</rename>
        <type>None</type>
        <length>20</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CEP</name>
        <rename>CEP</rename>
        <type>None</type>
        <length>8</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>EMAIL</name>
        <rename>EMAIL</rename>
        <type>None</type>
        <length>50</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>CELL</name>
        <rename>CELL</rename>
        <type>None</type>
        <length>30</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>TELL</name>
        <rename>TELL</rename>
        <type>None</type>
        <length>30</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_CADASTRO</name>
        <rename>DATA_CADASTRO</rename>
        <type>Date</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DATA_ULTIMA_ATUALIZACAO</name>
        <rename>DATA_ULTIMA_ATUALIZACAO</rename>
        <type>Date</type>
        <length>3</length>
        <precision>-2</precision>
        <conversion_mask>MM-dd-yyyy HH:mm:ss</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <GUI>
      <xloc>384</xloc>
      <yloc>384</yloc>
    </GUI>
  </transform>
  <transform>
    <name>bqtb_EmpresasGrupoBamaq</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>DBSGE</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>select * from bqtb_EmpresasGrupoBamaq</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>1312</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>clientes_dealer</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>DEALER</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT  DISTINCT
    'DEALERNETWF' AS SYSORIGEM, 
    pc.Pessoa_Codigo AS CODCLIENTE,     
    pc.Pessoa_Nome AS CLIENTE, 
    te.TipoEndereco_Descricao as TIPOENDERECO,

    CASE WHEN 
        (SELECT COUNT(*) FROM PessoaEndereco WHERE pessoa_codigo = pc.Pessoa_Codigo) = 1 
        THEN 'S' 
        ELSE CASE WHEN (SELECT NotaFiscal_PessoaTipoEnderecoCod
                        FROM NotaFiscal 
                        WHERE NotaFiscal_Codigo in (SELECT max(NotaFiscal_Codigo)
                                                    FROM NotaFiscal
                                                    WHERE NotaFiscal_PessoaCod = 1339)) = te.TipoEndereco_Codigo THEN 'S' ELSE 'N' 
            END 
    END AS PRINCIPAL,

    isnull(pe.PessoaEndereco_EstadoCod,'') AS UF, 
    m.Municipio_nome as CIDADE,
    pe.PessoaEndereco_Bairro as BAIRRO,
    pe.PessoaEndereco_Logradouro as LOGRADOURO,
    pe.PessoaEndereco_Numero as NUMERO,
    pe.PessoaEndereco_Complemento as COMPLEMENTO, 
    pe.PessoaEndereco_CEP as CEP,
    pc.Pessoa_Email as EMAIL,
    (select top 1 ltrim(rtrim(PessoaTeleFone_DDD)) + ltrim(rtrim(PessoaTelefone_Fone)) from PessoaTelefone where PessoaTelefone_TipoTelefone = 1 and Pessoa_Codigo = pc.Pessoa_Codigo order by PessoaTelefone_DataAlteracao desc) AS TELL,
    (select top 1 ltrim(rtrim(PessoaTeleFone_DDD)) + ltrim(rtrim(PessoaTelefone_Fone)) from PessoaTelefone where PessoaTelefone_TipoTelefone = 2 and Pessoa_Codigo = pc.Pessoa_Codigo order by PessoaTelefone_DataAlteracao desc) AS CELL,
    CASE pC.Pessoa_TipoPessoa 
        WHEN 'F' THEN 'FISICA' 
        WHEN 'J' THEN 'JURIDICA' 
    ELSE 'OUTRA' END AS TIPOFJ,

    pc.Pessoa_DocIdentificador as DOCCLI,

    pe.PessoaEndereco_DataCriacao as DATA_CADASTRO,
    
    (select max(NotaFiscal_DataEmissao)
    from NotaFiscal 
    where NotaFiscal_PessoaCod = pc.Pessoa_Codigo
    and NotaFiscal_Movimento = 'S'
    and NotaFiscal_Status in ('EMI')) AS DATA_ULTIMA_ATUALIZACAO

    /*(select sum(NotaFiscal_ValorTotal)
    from NotaFiscal 
    where NotaFiscal_PessoaCod = pc.Pessoa_Codigo
    and NotaFiscal_Movimento = 'S'
    and NotaFiscal_Status not in ('EMI')) AS FATDEALERNET */

    FROM Pessoa pc

    LEFT JOIN PessoaEndereco pe 
    ON 
    pe.Pessoa_Codigo = pc.Pessoa_Codigo and pe.PessoaEndereco_Status = 1
    
    LEFT JOIN TipoEndereco te
    ON
    te.TipoEndereco_Codigo = pe.PessoaEndereco_TipoEnderecoCod

    LEFT JOIN [Municipio] m 
    ON 
    m.Municipio_Codigo = pe.PessoaEndereco_MunicipioCod

WHERE EXISTS (  SELECT NotaFiscal_PessoaCod 
                FROM NotaFiscal 
                WHERE NotaFiscal_Movimento = 'S' 
                    and NotaFiscal_Status in ('EMI') 
                    and NotaFiscal_PessoaCod = pc.Pessoa_Codigo)</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>192</xloc>
      <yloc>288</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dealer_faturamento</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>DEALER</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT * FROM

(

-- SELEÇÃO DE FATURAMENTO TIPO "SERVIÇOS"
SELECT	
		'DEALERNETWF' AS SYSORIGEM, 
		e.Empresa_Nome as EMPRESA,
		e.Empresa_Codigo as CODEMPRESA,
		em.Empresa_Nome as BANDEIRA,
		pc.Pessoa_DocIdentificador as DOCCLI,
		pc.Pessoa_Codigo AS CODCLIENTE,
		CASE tno.NaturezaOperacao_TipoItem WHEN 'P' THEN 'Produto' WHEN 'A' THEN 'Avulso' WHEN 'V' THEN 'Veículo' WHEN 'T' THEN 'Mão de Obra' Else 'Desconhecido' END as TIPO_OPERACAO,
		'Serviços' as TIPO_VENDA,
		td.TipoDocumento_Descricao AS TIPO_DOCUMENTO,
		CAST(nf.NotaFiscal_DataEmissao as date) as DATA_EMISSAO,
		CAST(nf.NotaFiscal_DataChegada as date) as DATA_ENTRADA,
		nf.NotaFiscal_Codigo AS DOCUMENTO,
		nf.NotaFiscal_Numero AS NF_NUMERO,
		dp.Departamento_Descricao AS DEPARTAMENTO,
		onf.NaturezaOperacao_Descricao as OPERACAO,
		ts.TipoServico_Descricao as TIPO_PRODUTO,
				CASE TMO.TMO_Tipo
			WHEN 'DES' THEN 'Deslocamento'
			WHEN 'DIA' THEN 'Diagnóstico'
			WHEN 'LAV' THEN 'Lavagem'
			WHEN 'MAN' THEN 'Manutenção'
			WHEN 'MPE' THEN 'Manutenção Periódica'
			WHEN 'REN' THEN 'Revisão Mecânica'
			WHEN 'RFU' THEN 'Revisão Funilaria'
			WHEN 'RME' THEN 'Revisão de Entrega'
			WHEN 'TEX' THEN 'Trabalho Externo' 
		END as GRUPO_PRODUTO,
		tmo.TMO_Descricao as PRODUTO,
		ni.NotaFiscalItem_Qtde as QTDE,
		NotaFiscalItem_ValorUnitario + NotaFiscalItem_ValorAcrescimo as VLR_LIQUIDO_TOTAL_ITEM,
		u.Usuario_Nome as USUARIO

FROM NotaFiscal nf 

	INNER JOIN NotaFiscalItem ni 
	ON ni.NotaFiscal_Codigo = nf.NotaFiscal_Codigo

	INNER JOIN Pessoa pc
	ON  
	nf.NotaFiscal_PessoaCod = pc.Pessoa_Codigo

	INNER JOIN Empresa e
	ON 
	e.Empresa_Codigo = nf.NotaFiscal_EmpresaCod

	INNER JOIN Empresa em
	ON 
	em.Empresa_Codigo = e.Empresa_EmpresaCodMatriz

	INNER JOIN NaturezaOperacao onf 
	ON
	onf.NaturezaOperacao_Codigo = nf.NotaFiscal_NaturezaOperacaoCod

	INNER JOIN NaturezaOperacaoTipoItem tno 
	ON
	tno.NaturezaOperacao_Codigo = onf.NaturezaOperacao_Codigo

	LEFT JOIN TMO 
	ON 
	TMO.TMO_Codigo = ni.NotaFiscalItem_TMOCod

	LEFT JOIN TipoServico ts on ts.TipoServico_Codigo = TMO.TipoServico_Codigo

	LEFT JOIN Departamento dp on dp.Departamento_Codigo = nf.NotaFiscal_DepartamentoCod

	LEFT JOIN TipoDocumento td on td.TipoDocumento_Codigo = nf.NotaFiscal_TipoDocumentoCod

	LEFT JOIN Usuario u on u.Usuario_Codigo = nf.NotaFiscal_UsuCodVendedor

WHERE	NotaFiscal_Movimento = 'S' 
		and NotaFiscal_Status in ('EMI')
		
		-- NotaFiscal_Serie &lt;&gt; "1" determina que o tipo de venda é de SERVIÇOS.
		and onf.NaturezaOperacao_GrupoMovimento = 'VEN'
		and onf.NaturezaOperacao_Codigo in (select distinct TipoOsEmp_NatOpeCod from TipoOsEmp) 
		and NaturezaOperacao_Classificacao = 'OUT'
		and tno.NaturezaOperacao_TipoItem = 'T'
		and nf.NotaFiscal_Serie &lt;&gt; '1'


union


-- SELEÇÃO DE FATURAMENTO TIPO "VEICULOS"
SELECT	
		'DEALER' AS SYSORIGEM, 
		e.Empresa_Nome as EMPRESA,
		e.Empresa_Codigo,
		em.Empresa_Nome as BANDEIRA,
		pc.Pessoa_DocIdentificador as DOCCLI,
		pc.Pessoa_Codigo AS CODCLIENTE,
		CASE tno.NaturezaOperacao_TipoItem WHEN 'P' THEN 'Produto' WHEN 'A' THEN 'Avulso' WHEN 'V' THEN 'Veículo' WHEN 'T' THEN 'Mão de Obra' Else 'Desconhecido' END as TIPO_OPERACAO,
		'Veículos' as TIPO_VENDA,
		td.TipoDocumento_Descricao AS TIPO_DOCUMENTO,
		CAST(nf.NotaFiscal_DataEmissao as date) as DATA_EMISSAO,
		CAST(nf.NotaFiscal_DataChegada as date) as DATA_ENTRADA,
		nf.NotaFiscal_Codigo AS DOCUMENTO,
		nf.NotaFiscal_Numero AS NF_NUMERO,
		dp.Departamento_Descricao AS DEPARTAMENTO,
		onf.NaturezaOperacao_Descricao as OPERACAO,

		CASE fv.FamiliaVeiculo_Tipo
			WHEN 'O' THEN 'Comercial Pesado'
			WHEN 'P' THEN 'passageiro'
			WHEN 'G' THEN 'Extra Pesado'
			WHEN 'C' THEN 'Comercial leve'
			WHEN 'I' THEN 'Importado'
			WHEN 'M' THEN 'Comercial Médio'
			WHEN 'A' THEN 'Pesados A'
			WHEN 'B' THEN 'Pesados B'
			WHEN 'E' THEN 'Pesados C'
			WHEN 'D' THEN 'Pesados D'
			WHEN 'F' THEN 'Extra A'
		END as TIPO_PRODUTO,
		fv.FamiliaVeiculo_Descricao AS GRUPO_PRODUTO,
		v.Veiculo_Descricao as PRODUTO,
		ni.NotaFiscalItem_Qtde as QTDE,
		NotaFiscalItem_ValorTotal + NotaFiscalItem_ValorAcrescimo as VLR_LIQUIDO_TOTAL_ITEM,
		u.Usuario_Nome as usuario

FROM NotaFiscal nf 

	INNER JOIN NotaFiscalItem ni 
	ON ni.NotaFiscal_Codigo = nf.NotaFiscal_Codigo

	INNER JOIN Pessoa pc
	ON  
	nf.NotaFiscal_PessoaCod = pc.Pessoa_Codigo

	INNER JOIN Empresa e
	ON 
	e.Empresa_Codigo = nf.NotaFiscal_EmpresaCod

	INNER JOIN Empresa em
	ON 
	em.Empresa_Codigo = e.Empresa_EmpresaCodMatriz

	LEFT JOIN NaturezaOperacao onf 
	ON
	onf.NaturezaOperacao_Codigo = nf.NotaFiscal_NaturezaOperacaoCod

	LEFT JOIN NaturezaOperacaoTipoItem tno 
	ON
	tno.NaturezaOperacao_Codigo = onf.NaturezaOperacao_Codigo

	LEFT JOIN veiculo v 
	ON 
	v.Veiculo_Codigo = ni.NotaFiscalItem_VeiculoCod

	LEFT JOIN ModeloVeiculo mv 
	ON
	mv.ModeloVeiculo_Codigo = v.Veiculo_ModeloVeiculoCod

	LEFT JOIN Marca mc
	ON 
	mc.Marca_Codigo = mv.ModeloVeiculo_MarcaCod

	LEFT JOIN FamiliaVeiculo fv 
	ON
	fv.FamiliaVeiculo_Codigo = (case WHEN v.Veiculo_Status = 'N' then mv.ModeloVeiculo_FamiliaVeiculoCod_Novos else mv.ModeloVeiculo_FamiliaVeiculoCod_Usados END)

	LEFT JOIN Departamento dp on dp.Departamento_Codigo = nf.NotaFiscal_DepartamentoCod

	LEFT JOIN TipoDocumento td on td.TipoDocumento_Codigo = nf.NotaFiscal_TipoDocumentoCod

	LEFT JOIN Usuario u on u.Usuario_Codigo = nf.NotaFiscal_UsuCodVendedor

WHERE	NotaFiscal_Movimento = 'S' 
		and NotaFiscal_Status in ('EMI')
		
		-- NaturezaOperacao_TipoItem = "V" determina que o tipo de venda é de maquinas.
		and onf.NaturezaOperacao_GrupoMovimento = 'VEN'
		and tno.NaturezaOperacao_TipoItem = 'V'
		--and nf.NotaFiscal_Serie &lt;&gt; '1'


union


-- SELEÇÃO DE MOVIMENTAÇÃO MERCEDES BENZ - 'PEÇAS'
SELECT	
		'DEALER' AS SYSORIGEM, 
		e.Empresa_Nome as EMPRESA,
		e.Empresa_Codigo,
		em.Empresa_Nome as BANDEIRA,
		pc.Pessoa_DocIdentificador as DOCCLI,
		pc.Pessoa_Codigo AS CODCLIENTE,
		CASE tno.NaturezaOperacao_TipoItem WHEN 'P' THEN 'Produto' WHEN 'A' THEN 'Avulso' WHEN 'V' THEN 'Veículo' WHEN 'T' THEN 'Mão de Obra' Else 'Desconhecido' END as TIPO_OPERACAO,
		'Peças' as TIPO_VENDA,
		td.TipoDocumento_Descricao AS TIPO_DOCUMENTO,
		CAST(nf.NotaFiscal_DataEmissao as date) as DATA_EMISSAO,
		CAST(nf.NotaFiscal_DataChegada as date) as DATA_ENTRADA,
		nf.NotaFiscal_Codigo AS DOCUMENTO,
		nf.NotaFiscal_Numero AS NF_NUMERO,
		dp.Departamento_Descricao AS DEPARTAMENTO,
		onf.NaturezaOperacao_Descricao as OPERACAO,
		tp.TipoProduto_Descricao as TIPO_PRODUTO,
		gp.GrupoProduto_Descricao as GRUPO_PRODUTO,
		p.Produto_Descricao as PRODUTO,
		ni.NotaFiscalItem_Qtde as QTDE,
		NotaFiscalItem_ValorTotal + NotaFiscalItem_ValorAcrescimo as VLR_LIQUIDO_TOTAL_ITEM,
		u.Usuario_Nome as usuario

FROM NotaFiscal nf 

	INNER JOIN NotaFiscalItem ni 
	ON ni.NotaFiscal_Codigo = nf.NotaFiscal_Codigo

	INNER JOIN Pessoa pc
	ON  
	nf.NotaFiscal_PessoaCod = pc.Pessoa_Codigo

	INNER JOIN Empresa e
	ON 
	e.Empresa_Codigo = nf.NotaFiscal_EmpresaCod

	INNER JOIN Empresa em
	ON 
	em.Empresa_Codigo = e.Empresa_EmpresaCodMatriz

	INNER JOIN NaturezaOperacao onf 
	ON
	onf.NaturezaOperacao_Codigo = nf.NotaFiscal_NaturezaOperacaoCod

	INNER JOIN NaturezaOperacaoTipoItem tno 
	ON
	tno.NaturezaOperacao_Codigo = onf.NaturezaOperacao_Codigo

	INNER JOIN Produto p on p.Produto_Codigo = ni.NotaFiscalItem_ProdutoCod

	LEFT JOIN TipoProduto tp on tp.TipoProduto_Codigo = p.TipoProduto_Codigo

	LEFT JOIN GrupoProduto gp on gp.GrupoProduto_Codigo = p.GrupoProduto_Codigo

	LEFT JOIN Departamento dp on dp.Departamento_Codigo = nf.NotaFiscal_DepartamentoCod

	LEFT JOIN TipoDocumento td on td.TipoDocumento_Codigo = nf.NotaFiscal_TipoDocumentoCod

	LEFT JOIN Usuario u on u.Usuario_Codigo = nf.NotaFiscal_UsuCodVendedor

WHERE	NotaFiscal_Movimento = 'S' 
		and NotaFiscal_Status in ('EMI')
		
		-- NaturezaOperacao_TipoItem = "P" determina que o tipo de venda é de peças.
		and onf.NaturezaOperacao_GrupoMovimento = 'VEN'
		and tno.NaturezaOperacao_TipoItem = 'P'
		and nf.NotaFiscal_Serie = '1'

--order by 2 
		
)T1

WHERE DATA_EMISSAO >= DATEADD(MONTH, -12, GETDATE())</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>848</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dim_bandeiras_bamaq</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SistemaOrigem</column_name>
        <stream_name>SistemaOrigem</stream_name>
      </field>
      <field>
        <column_name>CodMatriz</column_name>
        <stream_name>CodMatriz</stream_name>
      </field>
      <field>
        <column_name>CodEmpresa</column_name>
        <stream_name>CodEmpresa</stream_name>
      </field>
      <field>
        <column_name>Bandeira</column_name>
        <stream_name>Bandeira</stream_name>
      </field>
      <field>
        <column_name>NomeEmpresaDmsErp</column_name>
        <stream_name>NomeEmpresaDmsErp</stream_name>
      </field>
      <field>
        <column_name>NomeExibicao</column_name>
        <stream_name>NomeExibicao</stream_name>
      </field>
      <field>
        <column_name>UnidadeNegocio</column_name>
        <stream_name>UnidadeNegocio</stream_name>
      </field>
      <field>
        <column_name>UrlLogoEmpresa</column_name>
        <stream_name>UrlLogoEmpresa</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>STAGING</schema>
    <specify_fields>Y</specify_fields>
    <table>dim_bandeiras_bamaq</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>1552</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dim_clientes_dealer</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>TIPOENDERECO</column_name>
        <stream_name>TIPOENDERECO</stream_name>
      </field>
      <field>
        <column_name>PRINCIPAL</column_name>
        <stream_name>PRINCIPAL</stream_name>
      </field>
      <field>
        <column_name>UF</column_name>
        <stream_name>UF</stream_name>
      </field>
      <field>
        <column_name>CIDADE</column_name>
        <stream_name>CIDADE</stream_name>
      </field>
      <field>
        <column_name>BAIRRO</column_name>
        <stream_name>BAIRRO</stream_name>
      </field>
      <field>
        <column_name>LOGRADOURO</column_name>
        <stream_name>LOGRADOURO</stream_name>
      </field>
      <field>
        <column_name>NUMERO</column_name>
        <stream_name>NUMERO</stream_name>
      </field>
      <field>
        <column_name>COMPLEMENTO</column_name>
        <stream_name>COMPLEMENTO</stream_name>
      </field>
      <field>
        <column_name>CEP</column_name>
        <stream_name>CEP</stream_name>
      </field>
      <field>
        <column_name>EMAIL</column_name>
        <stream_name>EMAIL</stream_name>
      </field>
      <field>
        <column_name>TELL</column_name>
        <stream_name>TELL</stream_name>
      </field>
      <field>
        <column_name>CELL</column_name>
        <stream_name>CELL</stream_name>
      </field>
      <field>
        <column_name>TIPOFJ</column_name>
        <stream_name>TIPOFJ</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>DATA_CADASTRO</column_name>
        <stream_name>DATA_CADASTRO</stream_name>
      </field>
      <field>
        <column_name>DATA_ULTIMA_ATUALIZACAO</column_name>
        <stream_name>DATA_ULTIMA_ATUALIZACAO</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_field/>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dim_clientes_dealer</table>
    <tablename_field/>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>592</xloc>
      <yloc>288</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dim_clientes_nbs</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>TIPOENDERECO</column_name>
        <stream_name>TIPOENDERECO</stream_name>
      </field>
      <field>
        <column_name>ENDERECOPRINCIPAL</column_name>
        <stream_name>ENDERECOPRINCIPAL</stream_name>
      </field>
      <field>
        <column_name>UF</column_name>
        <stream_name>UF</stream_name>
      </field>
      <field>
        <column_name>CIDADE</column_name>
        <stream_name>CIDADE</stream_name>
      </field>
      <field>
        <column_name>BAIRRO</column_name>
        <stream_name>BAIRRO</stream_name>
      </field>
      <field>
        <column_name>LOGRADOURO</column_name>
        <stream_name>LOGRADOURO</stream_name>
      </field>
      <field>
        <column_name>NUMERO</column_name>
        <stream_name>NUMERO</stream_name>
      </field>
      <field>
        <column_name>COMPLEMENTO</column_name>
        <stream_name>COMPLEMENTO</stream_name>
      </field>
      <field>
        <column_name>CEP</column_name>
        <stream_name>CEP</stream_name>
      </field>
      <field>
        <column_name>EMAIL</column_name>
        <stream_name>EMAIL</stream_name>
      </field>
      <field>
        <column_name>TELL</column_name>
        <stream_name>TELL</stream_name>
      </field>
      <field>
        <column_name>CELL</column_name>
        <stream_name>CELL</stream_name>
      </field>
      <field>
        <column_name>TIPOFJ</column_name>
        <stream_name>TIPOFJ</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>DATA_CADASTRO</column_name>
        <stream_name>DATA_CADASTRO</stream_name>
      </field>
      <field>
        <column_name>DATA_ULTIMA_ATUALIZACAO</column_name>
        <stream_name>DATA_ULTIMA_ATUALIZACAO</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_field/>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dim_clientes_nbs</table>
    <tablename_field/>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>592</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dim_clientes_newcon</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>TIPOFJ</column_name>
        <stream_name>TIPOFJ</stream_name>
      </field>
      <field>
        <column_name>TIPOENDERECO</column_name>
        <stream_name>TIPOENDERECO</stream_name>
      </field>
      <field>
        <column_name>ENDERECOPRINCIPAL</column_name>
        <stream_name>ENDERECOPRINCIPAL</stream_name>
      </field>
      <field>
        <column_name>CIDADE</column_name>
        <stream_name>CIDADE</stream_name>
      </field>
      <field>
        <column_name>UF</column_name>
        <stream_name>UF</stream_name>
      </field>
      <field>
        <column_name>BAIRRO</column_name>
        <stream_name>BAIRRO</stream_name>
      </field>
      <field>
        <column_name>LOGRADOURO</column_name>
        <stream_name>LOGRADOURO</stream_name>
      </field>
      <field>
        <column_name>NUMERO</column_name>
        <stream_name>NUMERO</stream_name>
      </field>
      <field>
        <column_name>COMPLEMENTO</column_name>
        <stream_name>COMPLEMENTO</stream_name>
      </field>
      <field>
        <column_name>CEP</column_name>
        <stream_name>CEP</stream_name>
      </field>
      <field>
        <column_name>EMAIL</column_name>
        <stream_name>EMAIL</stream_name>
      </field>
      <field>
        <column_name>CELL</column_name>
        <stream_name>CELL</stream_name>
      </field>
      <field>
        <column_name>TELL</column_name>
        <stream_name>TELL</stream_name>
      </field>
      <field>
        <column_name>DATA_CADASTRO</column_name>
        <stream_name>DATA_CADASTRO</stream_name>
      </field>
      <field>
        <column_name>DATA_ULTIMA_ATUALIZACAO</column_name>
        <stream_name>DATA_ULTIMA_ATUALIZACAO</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_field/>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dim_clientes_newcon</table>
    <tablename_field/>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>592</xloc>
      <yloc>384</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dim_clientes_quiver</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>TIPO_ENDERECO</column_name>
        <stream_name>TIPO_ENDERECO</stream_name>
      </field>
      <field>
        <column_name>ENDERECOPRINCIPAL</column_name>
        <stream_name>ENDERECOPRINCIPAL</stream_name>
      </field>
      <field>
        <column_name>UF</column_name>
        <stream_name>UF</stream_name>
      </field>
      <field>
        <column_name>CIDADE</column_name>
        <stream_name>CIDADE</stream_name>
      </field>
      <field>
        <column_name>BAIRRO</column_name>
        <stream_name>BAIRRO</stream_name>
      </field>
      <field>
        <column_name>LOGRADOURO</column_name>
        <stream_name>LOGRADOURO</stream_name>
      </field>
      <field>
        <column_name>NUMERO</column_name>
        <stream_name>NUMERO</stream_name>
      </field>
      <field>
        <column_name>COMPLEMENTO</column_name>
        <stream_name>COMPLEMENTO</stream_name>
      </field>
      <field>
        <column_name>CEP</column_name>
        <stream_name>CEP</stream_name>
      </field>
      <field>
        <column_name>EMAIL</column_name>
        <stream_name>EMAIL</stream_name>
      </field>
      <field>
        <column_name>TELL</column_name>
        <stream_name>TELL</stream_name>
      </field>
      <field>
        <column_name>CELL</column_name>
        <stream_name>CELL</stream_name>
      </field>
      <field>
        <column_name>TIPOFJ</column_name>
        <stream_name>TIPOFJ</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>DATA_CADASTRO</column_name>
        <stream_name>DATA_CADASTRO</stream_name>
      </field>
      <field>
        <column_name>DATA_ULTIMA_ATUALIZACAO</column_name>
        <stream_name>DATA_ULTIMA_ATUALIZACAO</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_field/>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dim_clientes_quiver</table>
    <tablename_field/>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>592</xloc>
      <yloc>192</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_bamaq_logos_url</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>BANDEIRA</column_name>
        <stream_name>BANDEIRA</stream_name>
      </field>
      <field>
        <column_name>URL_IMAGEM</column_name>
        <stream_name>URL_IMAGEM</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_bamaq_logos_url</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>1552</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_faturamento_dealer</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>EMPRESA</column_name>
        <stream_name>EMPRESA</stream_name>
      </field>
      <field>
        <column_name>CODEMPRESA</column_name>
        <stream_name>CODEMPRESA</stream_name>
      </field>
      <field>
        <column_name>BANDEIRA</column_name>
        <stream_name>BANDEIRA</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>TIPO_OPERACAO</column_name>
        <stream_name>TIPO_OPERACAO</stream_name>
      </field>
      <field>
        <column_name>TIPO_VENDA</column_name>
        <stream_name>TIPO_VENDA</stream_name>
      </field>
      <field>
        <column_name>TIPO_DOCUMENTO</column_name>
        <stream_name>TIPO_DOCUMENTO</stream_name>
      </field>
      <field>
        <column_name>DATA_EMISSAO</column_name>
        <stream_name>DATA_EMISSAO</stream_name>
      </field>
      <field>
        <column_name>DATA_ENTRADA</column_name>
        <stream_name>DATA_ENTRADA</stream_name>
      </field>
      <field>
        <column_name>DOCUMENTO</column_name>
        <stream_name>DOCUMENTO</stream_name>
      </field>
      <field>
        <column_name>NF_NUMERO</column_name>
        <stream_name>NF_NUMERO</stream_name>
      </field>
      <field>
        <column_name>DEPARTAMENTO</column_name>
        <stream_name>DEPARTAMENTO</stream_name>
      </field>
      <field>
        <column_name>OPERACAO</column_name>
        <stream_name>OPERACAO</stream_name>
      </field>
      <field>
        <column_name>TIPO_PRODUTO</column_name>
        <stream_name>TIPO_PRODUTO</stream_name>
      </field>
      <field>
        <column_name>GRUPO_PRODUTO</column_name>
        <stream_name>GRUPO_PRODUTO</stream_name>
      </field>
      <field>
        <column_name>PRODUTO</column_name>
        <stream_name>PRODUTO</stream_name>
      </field>
      <field>
        <column_name>QTDE</column_name>
        <stream_name>QTDE</stream_name>
      </field>
      <field>
        <column_name>VLR_LIQUIDO_TOTAL_ITEM</column_name>
        <stream_name>VLR_LIQUIDO_TOTAL_ITEM</stream_name>
      </field>
      <field>
        <column_name>USUARIO</column_name>
        <stream_name>USUARIO</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_faturamento_dealer</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>1040</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_faturamento_nbs</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>DATA_NF</column_name>
        <stream_name>DATA_NF</stream_name>
      </field>
      <field>
        <column_name>CONTROLE</column_name>
        <stream_name>CONTROLE</stream_name>
      </field>
      <field>
        <column_name>SERIE</column_name>
        <stream_name>SERIE</stream_name>
      </field>
      <field>
        <column_name>COD_NATUREZA_RECEITA_DESPESA</column_name>
        <stream_name>COD_NATUREZA_RECEITA_DESPESA</stream_name>
      </field>
      <field>
        <column_name>STATUS</column_name>
        <stream_name>STATUS</stream_name>
      </field>
      <field>
        <column_name>COD_FORNECEDOR</column_name>
        <stream_name>COD_FORNECEDOR</stream_name>
      </field>
      <field>
        <column_name>COD_CENTRO_CUSTO</column_name>
        <stream_name>COD_CENTRO_CUSTO</stream_name>
      </field>
      <field>
        <column_name>COD_EMPRESA</column_name>
        <stream_name>COD_EMPRESA</stream_name>
      </field>
      <field>
        <column_name>EMPRESA</column_name>
        <stream_name>EMPRESA</stream_name>
      </field>
      <field>
        <column_name>COD_GRUPO_PC</column_name>
        <stream_name>COD_GRUPO_PC</stream_name>
      </field>
      <field>
        <column_name>GRUPO_PC</column_name>
        <stream_name>GRUPO_PC</stream_name>
      </field>
      <field>
        <column_name>COD_ITEM</column_name>
        <stream_name>COD_ITEM</stream_name>
      </field>
      <field>
        <column_name>ITEM</column_name>
        <stream_name>ITEM</stream_name>
      </field>
      <field>
        <column_name>NOVO_USADO</column_name>
        <stream_name>NOVO_USADO</stream_name>
      </field>
      <field>
        <column_name>COD_GRUPO_INTERNO</column_name>
        <stream_name>COD_GRUPO_INTERNO</stream_name>
      </field>
      <field>
        <column_name>COD_SUB_GRUPO_INTERNO</column_name>
        <stream_name>COD_SUB_GRUPO_INTERNO</stream_name>
      </field>
      <field>
        <column_name>COD_NATUREZA</column_name>
        <stream_name>COD_NATUREZA</stream_name>
      </field>
      <field>
        <column_name>COD_OPERACAO_FISCAL</column_name>
        <stream_name>COD_OPERACAO_FISCAL</stream_name>
      </field>
      <field>
        <column_name>DESCONTO_RATEADO</column_name>
        <stream_name>DESCONTO_RATEADO</stream_name>
      </field>
      <field>
        <column_name>DIAS_GIRO</column_name>
        <stream_name>DIAS_GIRO</stream_name>
      </field>
      <field>
        <column_name>GRUPO</column_name>
        <stream_name>GRUPO</stream_name>
      </field>
      <field>
        <column_name>CUSTO_RESULTANTE</column_name>
        <stream_name>CUSTO_RESULTANTE</stream_name>
      </field>
      <field>
        <column_name>QUANT</column_name>
        <stream_name>QUANT</stream_name>
      </field>
      <field>
        <column_name>QUANT_DEV</column_name>
        <stream_name>QUANT_DEV</stream_name>
      </field>
      <field>
        <column_name>CUSTO_PRODUTO</column_name>
        <stream_name>CUSTO_PRODUTO</stream_name>
      </field>
      <field>
        <column_name>PUNIT</column_name>
        <stream_name>PUNIT</stream_name>
      </field>
      <field>
        <column_name>DESC_PUNIT</column_name>
        <stream_name>DESC_PUNIT</stream_name>
      </field>
      <field>
        <column_name>PVENDIDO</column_name>
        <stream_name>PVENDIDO</stream_name>
      </field>
      <field>
        <column_name>MARGEM</column_name>
        <stream_name>MARGEM</stream_name>
      </field>
      <field>
        <column_name>TOTAL_NOTA</column_name>
        <stream_name>TOTAL_NOTA</stream_name>
      </field>
      <field>
        <column_name>TOTAL_VENDA_SDEV</column_name>
        <stream_name>TOTAL_VENDA_SDEV</stream_name>
      </field>
      <field>
        <column_name>TOTAL_VENDA_CDEV</column_name>
        <stream_name>TOTAL_VENDA_CDEV</stream_name>
      </field>
      <field>
        <column_name>TOTAL_DEVOLVIDO</column_name>
        <stream_name>TOTAL_DEVOLVIDO</stream_name>
      </field>
      <field>
        <column_name>DESC_TOTAL</column_name>
        <stream_name>DESC_TOTAL</stream_name>
      </field>
      <field>
        <column_name>NUMERO_OS</column_name>
        <stream_name>NUMERO_OS</stream_name>
      </field>
      <field>
        <column_name>COD_TIPO_OS</column_name>
        <stream_name>COD_TIPO_OS</stream_name>
      </field>
      <field>
        <column_name>TIPO_OS</column_name>
        <stream_name>TIPO_OS</stream_name>
      </field>
      <field>
        <column_name>INTERNO</column_name>
        <stream_name>INTERNO</stream_name>
      </field>
      <field>
        <column_name>GERA_FINANCEIRO</column_name>
        <stream_name>GERA_FINANCEIRO</stream_name>
      </field>
      <field>
        <column_name>COD_MODELO</column_name>
        <stream_name>COD_MODELO</stream_name>
      </field>
      <field>
        <column_name>COD_OPERACAO</column_name>
        <stream_name>COD_OPERACAO</stream_name>
      </field>
      <field>
        <column_name>COD_SETOR</column_name>
        <stream_name>COD_SETOR</stream_name>
      </field>
      <field>
        <column_name>COD_EMPRESA_DIVISAO</column_name>
        <stream_name>COD_EMPRESA_DIVISAO</stream_name>
      </field>
      <field>
        <column_name>COD_VENDEDOR</column_name>
        <stream_name>COD_VENDEDOR</stream_name>
      </field>
      <field>
        <column_name>VENDEDOR</column_name>
        <stream_name>VENDEDOR</stream_name>
      </field>
      <field>
        <column_name>COD_EMPRESA_DEPARTAMENTO</column_name>
        <stream_name>COD_EMPRESA_DEPARTAMENTO</stream_name>
      </field>
      <field>
        <column_name>TABREF</column_name>
        <stream_name>TABREF</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_faturamento_nbs</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>1040</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_faturamento_newcon</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>CODEMPRESA</column_name>
        <stream_name>CODEMPRESA</stream_name>
      </field>
      <field>
        <column_name>EMPRESA</column_name>
        <stream_name>EMPRESA</stream_name>
      </field>
      <field>
        <column_name>BANDEIRA</column_name>
        <stream_name>BANDEIRA</stream_name>
      </field>
      <field>
        <column_name>TIPOFJ</column_name>
        <stream_name>TIPOFJ</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>TIPO_OPERACAO</column_name>
        <stream_name>TIPO_OPERACAO</stream_name>
      </field>
      <field>
        <column_name>TIPO_VENDA</column_name>
        <stream_name>TIPO_VENDA</stream_name>
      </field>
      <field>
        <column_name>TIPO_DOCUMENTO</column_name>
        <stream_name>TIPO_DOCUMENTO</stream_name>
      </field>
      <field>
        <column_name>DATA_CADASTRO</column_name>
        <stream_name>DATA_CADASTRO</stream_name>
      </field>
      <field>
        <column_name>DATA_ALOCACAO</column_name>
        <stream_name>DATA_ALOCACAO</stream_name>
      </field>
      <field>
        <column_name>DOCUMENTO</column_name>
        <stream_name>DOCUMENTO</stream_name>
      </field>
      <field>
        <column_name>DEPARTAMENTO</column_name>
        <stream_name>DEPARTAMENTO</stream_name>
      </field>
      <field>
        <column_name>OPERACAO</column_name>
        <stream_name>OPERACAO</stream_name>
      </field>
      <field>
        <column_name>TIPO_PRODUTO</column_name>
        <stream_name>TIPO_PRODUTO</stream_name>
      </field>
      <field>
        <column_name>GRUPO_PRODUTO</column_name>
        <stream_name>GRUPO_PRODUTO</stream_name>
      </field>
      <field>
        <column_name>PRODUTO</column_name>
        <stream_name>PRODUTO</stream_name>
      </field>
      <field>
        <column_name>QTDE</column_name>
        <stream_name>QTDE</stream_name>
      </field>
      <field>
        <column_name>VLR_BEM_CONTRATADO</column_name>
        <stream_name>VLR_BEM_CONTRATADO</stream_name>
      </field>
      <field>
        <column_name>EQUIPE_VENDA</column_name>
        <stream_name>EQUIPE_VENDA</stream_name>
      </field>
      <field>
        <column_name>GRUPO</column_name>
        <stream_name>GRUPO</stream_name>
      </field>
      <field>
        <column_name>COTA</column_name>
        <stream_name>COTA</stream_name>
      </field>
      <field>
        <column_name>ID_COTA</column_name>
        <stream_name>ID_COTA</stream_name>
      </field>
      <field>
        <column_name>VERSAO</column_name>
        <stream_name>VERSAO</stream_name>
      </field>
      <field>
        <column_name>QT_PARCELAS</column_name>
        <stream_name>QT_PARCELAS</stream_name>
      </field>
      <field>
        <column_name>VALOR_ATUAL_BEM</column_name>
        <stream_name>VALOR_ATUAL_BEM</stream_name>
      </field>
      <field>
        <column_name>NO_PC_ATUAL</column_name>
        <stream_name>NO_PC_ATUAL</stream_name>
      </field>
      <field>
        <column_name>QT_PC_PAGAS</column_name>
        <stream_name>QT_PC_PAGAS</stream_name>
      </field>
      <field>
        <column_name>VLR_LIQUIDO_TOTAL_ITEM</column_name>
        <stream_name>VLR_LIQUIDO_TOTAL_ITEM</stream_name>
      </field>
      <field>
        <column_name>VL_PAGO_F_COMUM</column_name>
        <stream_name>VL_PAGO_F_COMUM</stream_name>
      </field>
      <field>
        <column_name>VL_PAGO_F_RESERVA</column_name>
        <stream_name>VL_PAGO_F_RESERVA</stream_name>
      </field>
      <field>
        <column_name>VL_PAGO_SEGURO</column_name>
        <stream_name>VL_PAGO_SEGURO</stream_name>
      </field>
      <field>
        <column_name>VL_PAGO_MULTA</column_name>
        <stream_name>VL_PAGO_MULTA</stream_name>
      </field>
      <field>
        <column_name>VL_PAGO_JUROS</column_name>
        <stream_name>VL_PAGO_JUROS</stream_name>
      </field>
      <field>
        <column_name>VL_PAGO_TX_ADM</column_name>
        <stream_name>VL_PAGO_TX_ADM</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_faturamento_newcon</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>1040</xloc>
      <yloc>368</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_faturamento_quiver</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>CODEMPRESA</column_name>
        <stream_name>CODEMPRESA</stream_name>
      </field>
      <field>
        <column_name>CODCLIENTE</column_name>
        <stream_name>CODCLIENTE</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>KEYREF</column_name>
        <stream_name>KEYREF</stream_name>
      </field>
      <field>
        <column_name>DOCUMENTO</column_name>
        <stream_name>DOCUMENTO</stream_name>
      </field>
      <field>
        <column_name>ALTERACAO</column_name>
        <stream_name>ALTERACAO</stream_name>
      </field>
      <field>
        <column_name>DATA_OPERACAO</column_name>
        <stream_name>DATA_OPERACAO</stream_name>
      </field>
      <field>
        <column_name>VALOR_COMISSA_VL</column_name>
        <stream_name>VALOR_COMISSA_VL</stream_name>
      </field>
      <field>
        <column_name>COD_OPERACAO</column_name>
        <stream_name>COD_OPERACAO</stream_name>
      </field>
      <field>
        <column_name>OPERACAO</column_name>
        <stream_name>OPERACAO</stream_name>
      </field>
      <field>
        <column_name>STATUS_FINANCEIRO</column_name>
        <stream_name>STATUS_FINANCEIRO</stream_name>
      </field>
      <field>
        <column_name>NIVEL</column_name>
        <stream_name>NIVEL</stream_name>
      </field>
      <field>
        <column_name>COD_DIVISAO</column_name>
        <stream_name>COD_DIVISAO</stream_name>
      </field>
      <field>
        <column_name>DIVISAO</column_name>
        <stream_name>DIVISAO</stream_name>
      </field>
      <field>
        <column_name>APOLICE</column_name>
        <stream_name>APOLICE</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>COD_SEGURADORA</column_name>
        <stream_name>COD_SEGURADORA</stream_name>
      </field>
      <field>
        <column_name>SEGURADORA</column_name>
        <stream_name>SEGURADORA</stream_name>
      </field>
      <field>
        <column_name>COD_PRODUTO</column_name>
        <stream_name>COD_PRODUTO</stream_name>
      </field>
      <field>
        <column_name>PRODUTO</column_name>
        <stream_name>PRODUTO</stream_name>
      </field>
      <field>
        <column_name>COD_RAMO</column_name>
        <stream_name>COD_RAMO</stream_name>
      </field>
      <field>
        <column_name>TIPO_NEGOCIO</column_name>
        <stream_name>TIPO_NEGOCIO</stream_name>
      </field>
      <field>
        <column_name>COD_GRUPO_HIERAR</column_name>
        <stream_name>COD_GRUPO_HIERAR</stream_name>
      </field>
      <field>
        <column_name>GRUPO_HIERAR</column_name>
        <stream_name>GRUPO_HIERAR</stream_name>
      </field>
      <field>
        <column_name>HIE_NV1</column_name>
        <stream_name>HIE_NV1</stream_name>
      </field>
      <field>
        <column_name>HIE_NV2</column_name>
        <stream_name>HIE_NV2</stream_name>
      </field>
      <field>
        <column_name>HIE_NV3</column_name>
        <stream_name>HIE_NV3</stream_name>
      </field>
      <field>
        <column_name>HIE_NV4</column_name>
        <stream_name>HIE_NV4</stream_name>
      </field>
      <field>
        <column_name>TIPO_ENDOSSO</column_name>
        <stream_name>TIPO_ENDOSSO</stream_name>
      </field>
      <field>
        <column_name>COD_TP_DOC</column_name>
        <stream_name>COD_TP_DOC</stream_name>
      </field>
      <field>
        <column_name>TP_DOC</column_name>
        <stream_name>TP_DOC</stream_name>
      </field>
      <field>
        <column_name>COD_SUB_TIPO</column_name>
        <stream_name>COD_SUB_TIPO</stream_name>
      </field>
      <field>
        <column_name>DESC_SUB_TIPO</column_name>
        <stream_name>DESC_SUB_TIPO</stream_name>
      </field>
      <field>
        <column_name>PREMIO_LIQUIDO</column_name>
        <stream_name>PREMIO_LIQUIDO</stream_name>
      </field>
      <field>
        <column_name>PREMIO_TOTAL</column_name>
        <stream_name>PREMIO_TOTAL</stream_name>
      </field>
      <field>
        <column_name>PREMIO_LIQDESC</column_name>
        <stream_name>PREMIO_LIQDESC</stream_name>
      </field>
      <field>
        <column_name>COMISSAO</column_name>
        <stream_name>COMISSAO</stream_name>
      </field>
      <field>
        <column_name>PARCELA_INICIAL</column_name>
        <stream_name>PARCELA_INICIAL</stream_name>
      </field>
      <field>
        <column_name>DATA_PROPOSTA</column_name>
        <stream_name>DATA_PROPOSTA</stream_name>
      </field>
      <field>
        <column_name>DATA_VENC_PRIMEIRA</column_name>
        <stream_name>DATA_VENC_PRIMEIRA</stream_name>
      </field>
      <field>
        <column_name>DATA_INCLUSAO</column_name>
        <stream_name>DATA_INCLUSAO</stream_name>
      </field>
      <field>
        <column_name>DATA_EMISSAO</column_name>
        <stream_name>DATA_EMISSAO</stream_name>
      </field>
      <field>
        <column_name>DATA_ENTRADA</column_name>
        <stream_name>DATA_ENTRADA</stream_name>
      </field>
      <field>
        <column_name>DATA_QUITCOM</column_name>
        <stream_name>DATA_QUITCOM</stream_name>
      </field>
      <field>
        <column_name>INICIO_VIGENCIA</column_name>
        <stream_name>INICIO_VIGENCIA</stream_name>
      </field>
      <field>
        <column_name>TERMINO_VIGENCIA</column_name>
        <stream_name>TERMINO_VIGENCIA</stream_name>
      </field>
      <field>
        <column_name>FORMA_RECEBIMENTO</column_name>
        <stream_name>FORMA_RECEBIMENTO</stream_name>
      </field>
      <field>
        <column_name>COMISSAO_QUITADA</column_name>
        <stream_name>COMISSAO_QUITADA</stream_name>
      </field>
      <field>
        <column_name>PROPOSTA</column_name>
        <stream_name>PROPOSTA</stream_name>
      </field>
      <field>
        <column_name>QTDE_PARC_COMIS</column_name>
        <stream_name>QTDE_PARC_COMIS</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_faturamento_quiver</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>1040</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_financeiro_dealer_pj1</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>agente_cobrador</column_name>
        <stream_name>agente_cobrador</stream_name>
      </field>
      <field>
        <column_name>cliente</column_name>
        <stream_name>cliente</stream_name>
      </field>
      <field>
        <column_name>cod_cliente</column_name>
        <stream_name>cod_cliente</stream_name>
      </field>
      <field>
        <column_name>cod_empresa</column_name>
        <stream_name>cod_empresa</stream_name>
      </field>
      <field>
        <column_name>cod_vendedor</column_name>
        <stream_name>cod_vendedor</stream_name>
      </field>
      <field>
        <column_name>Data_Adesao</column_name>
        <stream_name>Data_Adesao</stream_name>
      </field>
      <field>
        <column_name>data_cancelamento</column_name>
        <stream_name>data_cancelamento</stream_name>
      </field>
      <field>
        <column_name>Data_Contemplacao</column_name>
        <stream_name>Data_Contemplacao</stream_name>
      </field>
      <field>
        <column_name>data_emissao</column_name>
        <stream_name>data_emissao</stream_name>
      </field>
      <field>
        <column_name>Data_Entrega_Bem</column_name>
        <stream_name>Data_Entrega_Bem</stream_name>
      </field>
      <field>
        <column_name>data_pagamento</column_name>
        <stream_name>data_pagamento</stream_name>
      </field>
      <field>
        <column_name>data_previsao_pagamento</column_name>
        <stream_name>data_previsao_pagamento</stream_name>
      </field>
      <field>
        <column_name>data_vencimento</column_name>
        <stream_name>data_vencimento</stream_name>
      </field>
      <field>
        <column_name>departamento</column_name>
        <stream_name>departamento</stream_name>
      </field>
      <field>
        <column_name>doccli</column_name>
        <stream_name>doccli</stream_name>
      </field>
      <field>
        <column_name>eh_devolucao</column_name>
        <stream_name>eh_devolucao</stream_name>
      </field>
      <field>
        <column_name>empresa</column_name>
        <stream_name>empresa</stream_name>
      </field>
      <field>
        <column_name>forma_pagamento</column_name>
        <stream_name>forma_pagamento</stream_name>
      </field>
      <field>
        <column_name>juros</column_name>
        <stream_name>juros</stream_name>
      </field>
      <field>
        <column_name>lancamento_financeiro</column_name>
        <stream_name>lancamento_financeiro</stream_name>
      </field>
      <field>
        <column_name>matriz</column_name>
        <stream_name>matriz</stream_name>
      </field>
      <field>
        <column_name>multa</column_name>
        <stream_name>multa</stream_name>
      </field>
      <field>
        <column_name>natureza_operacao</column_name>
        <stream_name>natureza_operacao</stream_name>
      </field>
      <field>
        <column_name>negativado</column_name>
        <stream_name>negativado</stream_name>
      </field>
      <field>
        <column_name>NOSSO_NUMERO</column_name>
        <stream_name>NOSSO_NUMERO</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_codigo</column_name>
        <stream_name>nota_fiscal_codigo</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_numero</column_name>
        <stream_name>nota_fiscal_numero</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_serie</column_name>
        <stream_name>nota_fiscal_serie</stream_name>
      </field>
      <field>
        <column_name>num_titulo</column_name>
        <stream_name>num_titulo</stream_name>
      </field>
      <field>
        <column_name>parcela</column_name>
        <stream_name>parcela</stream_name>
      </field>
      <field>
        <column_name>situacao_cobranca</column_name>
        <stream_name>situacao_cobranca</stream_name>
      </field>
      <field>
        <column_name>Situacao_cota</column_name>
        <stream_name>Situacao_cota</stream_name>
      </field>
      <field>
        <column_name>status_titulo</column_name>
        <stream_name>status_titulo</stream_name>
      </field>
      <field>
        <column_name>sysorigem</column_name>
        <stream_name>sysorigem</stream_name>
      </field>
      <field>
        <column_name>tem_devolucao</column_name>
        <stream_name>tem_devolucao</stream_name>
      </field>
      <field>
        <column_name>tipo_movimento</column_name>
        <stream_name>tipo_movimento</stream_name>
      </field>
      <field>
        <column_name>tipo_titulo</column_name>
        <stream_name>tipo_titulo</stream_name>
      </field>
      <field>
        <column_name>titulo_saldo</column_name>
        <stream_name>titulo_saldo</stream_name>
      </field>
      <field>
        <column_name>valor_comissao</column_name>
        <stream_name>valor_comissao</stream_name>
      </field>
      <field>
        <column_name>valor_devido</column_name>
        <stream_name>valor_devido</stream_name>
      </field>
      <field>
        <column_name>valor_fundo_reserva</column_name>
        <stream_name>valor_fundo_reserva</stream_name>
      </field>
      <field>
        <column_name>valor_nominal_titulo</column_name>
        <stream_name>valor_nominal_titulo</stream_name>
      </field>
      <field>
        <column_name>valor_seguro</column_name>
        <stream_name>valor_seguro</stream_name>
      </field>
      <field>
        <column_name>valor_taxa_adminstrativa</column_name>
        <stream_name>valor_taxa_adminstrativa</stream_name>
      </field>
      <field>
        <column_name>valor_titulo</column_name>
        <stream_name>valor_titulo</stream_name>
      </field>
      <field>
        <column_name>valorpago</column_name>
        <stream_name>valorpago</stream_name>
      </field>
      <field>
        <column_name>vendedor</column_name>
        <stream_name>vendedor</stream_name>
      </field>
      <field>
        <column_name>cd_grupo</column_name>
        <stream_name>cd_grupo</stream_name>
      </field>
      <field>
        <column_name>grupo</column_name>
        <stream_name>grupo</stream_name>
      </field>
      <field>
        <column_name>cd_cota</column_name>
        <stream_name>cd_cota</stream_name>
      </field>
      <field>
        <column_name>versao</column_name>
        <stream_name>versao</stream_name>
      </field>
      <field>
        <column_name>Plano_Venda</column_name>
        <stream_name>Plano_Venda</stream_name>
      </field>
      <field>
        <column_name>Ponto_Venda</column_name>
        <stream_name>Ponto_Venda</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_financeiro_dealer_pj1</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>576</xloc>
      <yloc>960</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_financeiro_nbs_pj1</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>AGENTE_COBRADOR</column_name>
        <stream_name>AGENTE_COBRADOR</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>COD_CLIENTE</column_name>
        <stream_name>COD_CLIENTE</stream_name>
      </field>
      <field>
        <column_name>COD_EMPRESA</column_name>
        <stream_name>COD_EMPRESA</stream_name>
      </field>
      <field>
        <column_name>COD_VENDEDOR</column_name>
        <stream_name>COD_VENDEDOR</stream_name>
      </field>
      <field>
        <column_name>DATA_CANCELAMENTO</column_name>
        <stream_name>DATA_CANCELAMENTO</stream_name>
      </field>
      <field>
        <column_name>DATA_CONTEMPLACAO</column_name>
        <stream_name>DATA_CONTEMPLACAO</stream_name>
      </field>
      <field>
        <column_name>DATA_EMISSAO</column_name>
        <stream_name>DATA_EMISSAO</stream_name>
      </field>
      <field>
        <column_name>DATA_ENTREGA_BEM</column_name>
        <stream_name>DATA_ENTREGA_BEM</stream_name>
      </field>
      <field>
        <column_name>DATA_PAGAMENTO</column_name>
        <stream_name>DATA_PAGAMENTO</stream_name>
      </field>
      <field>
        <column_name>DATA_PREVISAO_PAGAMENTO</column_name>
        <stream_name>DATA_PREVISAO_PAGAMENTO</stream_name>
      </field>
      <field>
        <column_name>DATA_VENCIMENTO</column_name>
        <stream_name>DATA_VENCIMENTO</stream_name>
      </field>
      <field>
        <column_name>DEPARTAMENTO</column_name>
        <stream_name>DEPARTAMENTO</stream_name>
      </field>
      <field>
        <column_name>DOCCLI</column_name>
        <stream_name>DOCCLI</stream_name>
      </field>
      <field>
        <column_name>EH_DEVOLUCAO</column_name>
        <stream_name>EH_DEVOLUCAO</stream_name>
      </field>
      <field>
        <column_name>EMPRESA</column_name>
        <stream_name>EMPRESA</stream_name>
      </field>
      <field>
        <column_name>FORMA_PAGAMENTO</column_name>
        <stream_name>FORMA_PAGAMENTO</stream_name>
      </field>
      <field>
        <column_name>JUROS</column_name>
        <stream_name>JUROS</stream_name>
      </field>
      <field>
        <column_name>LANCAMENTO_FINANCEIRO</column_name>
        <stream_name>LANCAMENTO_FINANCEIRO</stream_name>
      </field>
      <field>
        <column_name>MATRIZ</column_name>
        <stream_name>MATRIZ</stream_name>
      </field>
      <field>
        <column_name>MULTA</column_name>
        <stream_name>MULTA</stream_name>
      </field>
      <field>
        <column_name>NATUREZA_OPERACAO</column_name>
        <stream_name>NATUREZA_OPERACAO</stream_name>
      </field>
      <field>
        <column_name>NEGATIVADO</column_name>
        <stream_name>NEGATIVADO</stream_name>
      </field>
      <field>
        <column_name>NOSSO_NUMERO</column_name>
        <stream_name>NOSSO_NUMERO</stream_name>
      </field>
      <field>
        <column_name>NOTA_FISCAL_CODIGO</column_name>
        <stream_name>NOTA_FISCAL_CODIGO</stream_name>
      </field>
      <field>
        <column_name>NOTA_FISCAL_NUMERO</column_name>
        <stream_name>NOTA_FISCAL_NUMERO</stream_name>
      </field>
      <field>
        <column_name>NOTA_FISCAL_SERIE</column_name>
        <stream_name>NOTA_FISCAL_SERIE</stream_name>
      </field>
      <field>
        <column_name>NUM_TITULO</column_name>
        <stream_name>NUM_TITULO</stream_name>
      </field>
      <field>
        <column_name>PARCELA</column_name>
        <stream_name>PARCELA</stream_name>
      </field>
      <field>
        <column_name>SITUACAO_COBRANCA</column_name>
        <stream_name>SITUACAO_COBRANCA</stream_name>
      </field>
      <field>
        <column_name>SITUACAO_COTA</column_name>
        <stream_name>SITUACAO_COTA</stream_name>
      </field>
      <field>
        <column_name>STATUS_TITULO</column_name>
        <stream_name>STATUS_TITULO</stream_name>
      </field>
      <field>
        <column_name>SYSORIGEM</column_name>
        <stream_name>SYSORIGEM</stream_name>
      </field>
      <field>
        <column_name>TEM_DEVOLUCAO</column_name>
        <stream_name>TEM_DEVOLUCAO</stream_name>
      </field>
      <field>
        <column_name>TIPO_MOVIMENTO</column_name>
        <stream_name>TIPO_MOVIMENTO</stream_name>
      </field>
      <field>
        <column_name>TIPO_TITULO</column_name>
        <stream_name>TIPO_TITULO</stream_name>
      </field>
      <field>
        <column_name>TITULO_SALDO</column_name>
        <stream_name>TITULO_SALDO</stream_name>
      </field>
      <field>
        <column_name>VALOR_COMISSAO</column_name>
        <stream_name>VALOR_COMISSAO</stream_name>
      </field>
      <field>
        <column_name>VALOR_DEVIDO</column_name>
        <stream_name>VALOR_DEVIDO</stream_name>
      </field>
      <field>
        <column_name>VALOR_FUNDO_RESERVA</column_name>
        <stream_name>VALOR_FUNDO_RESERVA</stream_name>
      </field>
      <field>
        <column_name>VALOR_NOMINAL_TITULO</column_name>
        <stream_name>VALOR_NOMINAL_TITULO</stream_name>
      </field>
      <field>
        <column_name>VALOR_SEGURO</column_name>
        <stream_name>VALOR_SEGURO</stream_name>
      </field>
      <field>
        <column_name>VALOR_TAXA_ADMINSTRATIVA</column_name>
        <stream_name>VALOR_TAXA_ADMINSTRATIVA</stream_name>
      </field>
      <field>
        <column_name>VALOR_TITULO</column_name>
        <stream_name>VALOR_TITULO</stream_name>
      </field>
      <field>
        <column_name>VALORPAGO</column_name>
        <stream_name>VALORPAGO</stream_name>
      </field>
      <field>
        <column_name>VENDEDOR</column_name>
        <stream_name>VENDEDOR</stream_name>
      </field>
      <field>
        <column_name>CD_GRUPO</column_name>
        <stream_name>CD_GRUPO</stream_name>
      </field>
      <field>
        <column_name>GRUPO</column_name>
        <stream_name>GRUPO</stream_name>
      </field>
      <field>
        <column_name>CD_COTA</column_name>
        <stream_name>CD_COTA</stream_name>
      </field>
      <field>
        <column_name>VERSAO</column_name>
        <stream_name>VERSAO</stream_name>
      </field>
      <field>
        <column_name>PLANO_VENDA</column_name>
        <stream_name>PLANO_VENDA</stream_name>
      </field>
      <field>
        <column_name>PONTO_VENDA</column_name>
        <stream_name>PONTO_VENDA</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_financeiro_nbs_pj1</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>576</xloc>
      <yloc>752</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_financeiro_newcon_pj1</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>agente_cobrador</column_name>
        <stream_name>agente_cobrador</stream_name>
      </field>
      <field>
        <column_name>cliente</column_name>
        <stream_name>cliente</stream_name>
      </field>
      <field>
        <column_name>cod_cliente</column_name>
        <stream_name>cod_cliente</stream_name>
      </field>
      <field>
        <column_name>cod_empresa</column_name>
        <stream_name>cod_empresa</stream_name>
      </field>
      <field>
        <column_name>cod_vendedor</column_name>
        <stream_name>cod_vendedor</stream_name>
      </field>
      <field>
        <column_name>Data_Adesao</column_name>
        <stream_name>Data_Adesao</stream_name>
      </field>
      <field>
        <column_name>data_cancelamento</column_name>
        <stream_name>data_cancelamento</stream_name>
      </field>
      <field>
        <column_name>Data_Contemplacao</column_name>
        <stream_name>Data_Contemplacao</stream_name>
      </field>
      <field>
        <column_name>data_emissao</column_name>
        <stream_name>data_emissao</stream_name>
      </field>
      <field>
        <column_name>Data_Entrega_Bem</column_name>
        <stream_name>Data_Entrega_Bem</stream_name>
      </field>
      <field>
        <column_name>data_pagamento</column_name>
        <stream_name>data_pagamento</stream_name>
      </field>
      <field>
        <column_name>data_previsao_pagamento</column_name>
        <stream_name>data_previsao_pagamento</stream_name>
      </field>
      <field>
        <column_name>data_vencimento</column_name>
        <stream_name>data_vencimento</stream_name>
      </field>
      <field>
        <column_name>departamento</column_name>
        <stream_name>departamento</stream_name>
      </field>
      <field>
        <column_name>doccli</column_name>
        <stream_name>doccli</stream_name>
      </field>
      <field>
        <column_name>eh_devolucao</column_name>
        <stream_name>eh_devolucao</stream_name>
      </field>
      <field>
        <column_name>empresa</column_name>
        <stream_name>empresa</stream_name>
      </field>
      <field>
        <column_name>forma_pagamento</column_name>
        <stream_name>forma_pagamento</stream_name>
      </field>
      <field>
        <column_name>juros</column_name>
        <stream_name>juros</stream_name>
      </field>
      <field>
        <column_name>lancamento_financeiro</column_name>
        <stream_name>lancamento_financeiro</stream_name>
      </field>
      <field>
        <column_name>matriz</column_name>
        <stream_name>matriz</stream_name>
      </field>
      <field>
        <column_name>multa</column_name>
        <stream_name>multa</stream_name>
      </field>
      <field>
        <column_name>natureza_operacao</column_name>
        <stream_name>natureza_operacao</stream_name>
      </field>
      <field>
        <column_name>negativado</column_name>
        <stream_name>negativado</stream_name>
      </field>
      <field>
        <column_name>NOSSO_NUMERO</column_name>
        <stream_name>NOSSO_NUMERO</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_codigo</column_name>
        <stream_name>nota_fiscal_codigo</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_numero</column_name>
        <stream_name>nota_fiscal_numero</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_serie</column_name>
        <stream_name>nota_fiscal_serie</stream_name>
      </field>
      <field>
        <column_name>num_titulo</column_name>
        <stream_name>num_titulo</stream_name>
      </field>
      <field>
        <column_name>parcela</column_name>
        <stream_name>parcela</stream_name>
      </field>
      <field>
        <column_name>situacao_cobranca</column_name>
        <stream_name>situacao_cobranca</stream_name>
      </field>
      <field>
        <column_name>Situacao_cota</column_name>
        <stream_name>Situacao_cota</stream_name>
      </field>
      <field>
        <column_name>status_titulo</column_name>
        <stream_name>status_titulo</stream_name>
      </field>
      <field>
        <column_name>sysorigem</column_name>
        <stream_name>sysorigem</stream_name>
      </field>
      <field>
        <column_name>tem_devolucao</column_name>
        <stream_name>tem_devolucao</stream_name>
      </field>
      <field>
        <column_name>tipo_movimento</column_name>
        <stream_name>tipo_movimento</stream_name>
      </field>
      <field>
        <column_name>tipo_titulo</column_name>
        <stream_name>tipo_titulo</stream_name>
      </field>
      <field>
        <column_name>titulo_saldo</column_name>
        <stream_name>titulo_saldo</stream_name>
      </field>
      <field>
        <column_name>valor_comissao</column_name>
        <stream_name>valor_comissao</stream_name>
      </field>
      <field>
        <column_name>valor_devido</column_name>
        <stream_name>valor_devido</stream_name>
      </field>
      <field>
        <column_name>valor_fundo_reserva</column_name>
        <stream_name>valor_fundo_reserva</stream_name>
      </field>
      <field>
        <column_name>valor_nominal_titulo</column_name>
        <stream_name>valor_nominal_titulo</stream_name>
      </field>
      <field>
        <column_name>valor_seguro</column_name>
        <stream_name>valor_seguro</stream_name>
      </field>
      <field>
        <column_name>valor_taxa_adminstrativa</column_name>
        <stream_name>valor_taxa_adminstrativa</stream_name>
      </field>
      <field>
        <column_name>valor_titulo</column_name>
        <stream_name>valor_titulo</stream_name>
      </field>
      <field>
        <column_name>valorpago</column_name>
        <stream_name>valorpago</stream_name>
      </field>
      <field>
        <column_name>vendedor</column_name>
        <stream_name>vendedor</stream_name>
      </field>
      <field>
        <column_name>cd_grupo</column_name>
        <stream_name>cd_grupo</stream_name>
      </field>
      <field>
        <column_name>grupo</column_name>
        <stream_name>grupo</stream_name>
      </field>
      <field>
        <column_name>cd_cota</column_name>
        <stream_name>cd_cota</stream_name>
      </field>
      <field>
        <column_name>versao</column_name>
        <stream_name>versao</stream_name>
      </field>
      <field>
        <column_name>Plano_Venda</column_name>
        <stream_name>Plano_Venda</stream_name>
      </field>
      <field>
        <column_name>Ponto_Venda</column_name>
        <stream_name>Ponto_Venda</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_financeiro_newcon_pj1</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>576</xloc>
      <yloc>848</yloc>
    </GUI>
  </transform>
  <transform>
    <name>dts_financeiro_quiver_pj1</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>STAGING</connection>
    <fields>
      <field>
        <column_name>agente_cobrador</column_name>
        <stream_name>agente_cobrador</stream_name>
      </field>
      <field>
        <column_name>cliente</column_name>
        <stream_name>cliente</stream_name>
      </field>
      <field>
        <column_name>cod_cliente</column_name>
        <stream_name>cod_cliente</stream_name>
      </field>
      <field>
        <column_name>cod_empresa</column_name>
        <stream_name>cod_empresa</stream_name>
      </field>
      <field>
        <column_name>cod_vendedor</column_name>
        <stream_name>cod_vendedor</stream_name>
      </field>
      <field>
        <column_name>data_cancelamento</column_name>
        <stream_name>data_cancelamento</stream_name>
      </field>
      <field>
        <column_name>data_emissao</column_name>
        <stream_name>data_emissao</stream_name>
      </field>
      <field>
        <column_name>data_pagamento</column_name>
        <stream_name>data_pagamento</stream_name>
      </field>
      <field>
        <column_name>data_previsao_pagamento</column_name>
        <stream_name>data_previsao_pagamento</stream_name>
      </field>
      <field>
        <column_name>data_vencimento</column_name>
        <stream_name>data_vencimento</stream_name>
      </field>
      <field>
        <column_name>departamento</column_name>
        <stream_name>departamento</stream_name>
      </field>
      <field>
        <column_name>doccli</column_name>
        <stream_name>doccli</stream_name>
      </field>
      <field>
        <column_name>eh_devolucao</column_name>
        <stream_name>eh_devolucao</stream_name>
      </field>
      <field>
        <column_name>empresa</column_name>
        <stream_name>empresa</stream_name>
      </field>
      <field>
        <column_name>forma_pagamento</column_name>
        <stream_name>forma_pagamento</stream_name>
      </field>
      <field>
        <column_name>juros</column_name>
        <stream_name>juros</stream_name>
      </field>
      <field>
        <column_name>lancamento_financeiro</column_name>
        <stream_name>lancamento_financeiro</stream_name>
      </field>
      <field>
        <column_name>matriz</column_name>
        <stream_name>matriz</stream_name>
      </field>
      <field>
        <column_name>multa</column_name>
        <stream_name>multa</stream_name>
      </field>
      <field>
        <column_name>natureza_operacao</column_name>
        <stream_name>natureza_operacao</stream_name>
      </field>
      <field>
        <column_name>negativado</column_name>
        <stream_name>negativado</stream_name>
      </field>
      <field>
        <column_name>NOSSO_NUMERO</column_name>
        <stream_name>NOSSO_NUMERO</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_codigo</column_name>
        <stream_name>nota_fiscal_codigo</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_numero</column_name>
        <stream_name>nota_fiscal_numero</stream_name>
      </field>
      <field>
        <column_name>nota_fiscal_serie</column_name>
        <stream_name>nota_fiscal_serie</stream_name>
      </field>
      <field>
        <column_name>num_titulo</column_name>
        <stream_name>num_titulo</stream_name>
      </field>
      <field>
        <column_name>parcela</column_name>
        <stream_name>parcela</stream_name>
      </field>
      <field>
        <column_name>status_titulo</column_name>
        <stream_name>status_titulo</stream_name>
      </field>
      <field>
        <column_name>sysorigem</column_name>
        <stream_name>sysorigem</stream_name>
      </field>
      <field>
        <column_name>tem_devolucao</column_name>
        <stream_name>tem_devolucao</stream_name>
      </field>
      <field>
        <column_name>tipo_movimento</column_name>
        <stream_name>tipo_movimento</stream_name>
      </field>
      <field>
        <column_name>tipo_titulo</column_name>
        <stream_name>tipo_titulo</stream_name>
      </field>
      <field>
        <column_name>titulo_saldo</column_name>
        <stream_name>titulo_saldo</stream_name>
      </field>
      <field>
        <column_name>valor_comissao</column_name>
        <stream_name>valor_comissao</stream_name>
      </field>
      <field>
        <column_name>valor_devido</column_name>
        <stream_name>valor_devido</stream_name>
      </field>
      <field>
        <column_name>valor_fundo_reserva</column_name>
        <stream_name>valor_fundo_reserva</stream_name>
      </field>
      <field>
        <column_name>valor_nominal_titulo</column_name>
        <stream_name>valor_nominal_titulo</stream_name>
      </field>
      <field>
        <column_name>valor_seguro</column_name>
        <stream_name>valor_seguro</stream_name>
      </field>
      <field>
        <column_name>valor_taxa_adminstrativa</column_name>
        <stream_name>valor_taxa_adminstrativa</stream_name>
      </field>
      <field>
        <column_name>valor_titulo</column_name>
        <stream_name>valor_titulo</stream_name>
      </field>
      <field>
        <column_name>valorpago</column_name>
        <stream_name>valorpago</stream_name>
      </field>
      <field>
        <column_name>vendedor</column_name>
        <stream_name>vendedor</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>staging</schema>
    <specify_fields>Y</specify_fields>
    <table>dts_financeiro_quiver_pj1</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>Y</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>576</xloc>
      <yloc>656</yloc>
    </GUI>
  </transform>
  <transform>
    <name>clientes_nbs</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>NBS</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>--NBS

SELECT        
    'NBS' AS SYSORIGEM,
    T1.COD_CLIENTE AS CODCLIENTE,
    T1.NOME AS CLIENTE,
    CASE T3.TIPO_END WHEN '1' THEN 'OUTRO' WHEN '2' THEN 'RESIDENCIAL' WHEN '3' THEN 'COMERCIAL' WHEN '4' THEN 'COBRANÇA' ELSE 'OUTRO' END AS TIPOENDERECO,
    T3.PRINCIPAL AS ENDERECOPRINCIPAL,
    T3.UF AS UF,
    T4.DESCRICAO AS CIDADE,
    --T3.COD_CIDADE,      
    T3.BAIRRO AS BAIRRO,
    T3.LOGRADOURO AS LOGRADOURO,
    T3.NUM AS NUMERO,
    T3.COMPL AS COMPLEMENTO,
    T3.CEP AS CEP,
    T1.ENDERECO_ELETRONICO AS EMAIL,
    CONCAT(T1.PREFIXO_RES, T1.TELEFONE_RES) AS TELL,
    CONCAT(T1.PREFIXO_CEL, T1.TELEFONE_CEL) AS CELL,
       
    CASE WHEN T1.COD_CLASSE = 'F' THEN 'FISICA'
         WHEN T1.COD_CLASSE = 'J' THEN 'JURIDICA'
        ELSE '****' 
    END AS TIPOFJ,
            
    CASE WHEN T2.CPF IS NULL THEN T2.CGC
         WHEN T2.CGC IS NULL THEN T2.CPF 
    END AS DOCCLI,
    T2.DATA_CADASTRO,
    T2.DATA_ULTIMA_ATUALIZACAO
FROM CLIENTES T1
LEFT JOIN CLIENTE_DIVERSO T2 ON T2.COD_CLIENTE  = T1.COD_CLIENTE 
LEFT JOIN VW_ENDERECO T3 ON T3.COD_CLIENTE  = T1.COD_CLIENTE
LEFT JOIN CIDADES T4 ON T4.COD_CIDADES = T3.COD_CIDADE 
WHERE 
    EXISTS (SELECT DISTINCT COD_CLIENTE FROM VENDAS WHERE COD_CLIENTE = T1.COD_CLIENTE)
    AND T3.CEP IS NOT NULL</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>192</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>nbs_faturamento</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>NBS</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT 
  'NBS' AS SYSORIGEM,
    C.COD_CLIENTE AS CODCLIENTE,
    C.NOME AS CLIENTE,    
    CASE WHEN CD.CPF IS NULL THEN CD.CGC
         WHEN CD.CGC IS NULL THEN CD.CPF 
         END AS DOCCLI,    
  TO_CHAR(V.EMISSAO, 'YYYY/MM/DD') AS DATA_NF,    
    VI.CONTROLE,
    CAST(VI.SERIE AS VARCHAR(10)) AS SERIE,
  OP.COD_NATUREZA_RECEITA_DESPESA,
  CAST(V.STATUS AS VARCHAR(30)) AS STATUS,    
    VI.COD_FORNECEDOR,
    CAST(VI.COD_CENTRO_CUSTO AS VARCHAR(30)) AS COD_CENTRO_CUSTO,
  CAST(E.COD_EMPRESA AS VARCHAR(10)) AS COD_EMPRESA,
  CAST(E.NOME AS VARCHAR(150)) AS EMPRESA,
  G.COD_GRUPO_PC,
    G.DESCRICAO AS GRUPO_PC,     
  CAST(I.COD_ITEM AS VARCHAR(30)) AS COD_ITEM,  
    I.DESCRICAO AS ITEM,  
    'N' AS NOVO_USADO,    
    I.COD_GRUPO_INTERNO,
    I.COD_SUB_GRUPO_INTERNO,    
    VI.COD_NATUREZA,   
    VI.COD_OPERACAO_FISCAL,
    VI.DESCONTO_RATEADO,
    VI.DIAS_GIRO,
    VI.GRUPO,
  CC.CUSTO_RESULTANTE, -- CUSTO_OP OU CUSTO_RESUL SEMELHANTES = CUSTO PROD    
    VI.QTDE AS QUANT,
    VI.QTDE_DEVOLVIDA AS QUANT_DEV,
  CC.CUSTO_OPERACAO AS CUSTO_PRODUTO, -- CUSTO_OP OU CUSTO_RESUL SEMELHANTES = CUSTO PROD
    VI.PRECO_UNITARIO AS PUNIT, -- USE AQUI 
  (VI.TOTAL_DESCONTOS / VI.QTDE) AS DESC_PUNIT,    
  (VI.PRECO_UNITARIO - (VI.TOTAL_DESCONTOS / VI.QTDE)) AS PVENDIDO,
  ((VI.PRECO_UNITARIO - (VI.TOTAL_DESCONTOS / VI.QTDE)) / CC.CUSTO_OPERACAO) AS MARGEM,
  V.TOTAL_NOTA, 
  ((VI.PRECO_UNITARIO - (VI.TOTAL_DESCONTOS / VI.QTDE)) * VI.QTDE) AS TOTAL_VENDA_SDEV,
  ((VI.QTDE_DEVOLVIDA * (VI.PRECO_UNITARIO - (VI.TOTAL_DESCONTOS / VI.QTDE)))*-1) + ((VI.PRECO_UNITARIO - (VI.TOTAL_DESCONTOS / VI.QTDE)) * VI.QTDE) AS TOTAL_VENDA_CDEV,
  ((VI.QTDE_DEVOLVIDA) * (VI.PRECO_UNITARIO)) AS TOTAL_DEVOLVIDO,
  VI.TOTAL_DESCONTOS AS DESC_TOTAL, -- USE AQUI -- OBS ESSE DESC É GERAL, P/ REALIZAR DESC_UNIT DIVIDA POR QUANT TOTAL DE ITENS
  OS.NUMERO_OS,
  OST.TIPO AS COD_TIPO_OS,
  OST.DESCRICAO AS TIPO_OS,
  OST.INTERNO,
    OST.GERA_FINANCEIRO,
    V.COD_MODELO,                      
    V.COD_OPERACAO,
    V.COD_SETOR,
    V.COD_EMPRESA_DIVISAO,
  EU.NOME AS COD_VENDEDOR,
    EU.NOME_COMPLETO AS VENDEDOR,    
    V.COD_EMPRESA_DEPARTAMENTO,   
    'PEÇAS' AS TABREF

FROM VENDAS V

INNER JOIN CLIENTES C ON C.COD_CLIENTE = V.COD_CLIENTE

INNER JOIN VENDA_ITENS VI ON VI.COD_EMPRESA = V.COD_EMPRESA AND VI.CONTROLE = V.CONTROLE AND VI.SERIE = V.SERIE

LEFT JOIN ITENS I ON I.COD_ITEM = VI.COD_ITEM 

INNER JOIN OPERACOES OP ON OP.COD_EMPRESA = V.COD_EMPRESA AND OP.COD_OPERACAO = V.COD_OPERACAO

LEFT JOIN GRUPO_PC G ON G.COD_GRUPO_PC = VI.COD_GRUPO_PC

LEFT JOIN EMPRESAS E ON E.COD_EMPRESA = V.COD_EMPRESA

LEFT JOIN EMPRESAS_USUARIOS EU ON EU.NOME = V.VENDEDOR

LEFT JOIN OS ON OS.COD_EMPRESA = V.COD_EMPRESA AND OS.NUMERO_OS = V.NUMERO_OS

LEFT JOIN OS_TIPOS OST ON OST.TIPO = OS.TIPO 

LEFT JOIN CARDEX_CONTABIL CC ON CC.COD_EMPRESA = V.COD_EMPRESA AND CC.CONTROLE = V.CONTROLE AND CC.COD_ITEM = VI.COD_ITEM

LEFT JOIN CLIENTE_DIVERSO CD ON CD.COD_CLIENTE = C.COD_CLIENTE

LEFT JOIN CIDADES CI ON CI.COD_CIDADES= CD.COD_CIDADES

WHERE v.emissao BETWEEN ADD_MONTHS(TRUNC(SYSDATE, 'MM'), -12) AND TRUNC(SYSDATE, 'DD')
--WHERE V.VENDEDOR &lt;&gt; 'NBS' --NBS É ADM DO SISTEMA E DEVE SER RETIRADO PARA EVITAR DUPLICIDADES
AND V.COD_OPERACAO IN (1, 2, 3, 13, 19, 22, 26)
AND NVL(V.STATUS,'') &lt;&gt; 1


UNION ALL

SELECT 
  'NBS' AS SYSORIGEM,
  C.COD_CLIENTE,
  C.NOME AS CLIENTE,  
    CASE WHEN CD.CPF IS NULL THEN CD.CGC
         WHEN CD.CGC IS NULL THEN CD.CPF 
         END AS DOCCLI,
  TO_CHAR(VP.DATA_VENDA, 'YYYY/MM/DD') AS DATA_NF,    
  NVL(VP.CONTROLE_NOTA_INTERNET,V.CONTROLE) AS CONTROLE,
    CAST(V.SERIE AS VARCHAR(10)) AS SERIE,  
  NULL AS COD_NATUREZA_RECEITA_DESPESA,
    CAST(VP.STATUS_PROPOSTA AS VARCHAR(30)) AS STATUS,  
    NULL AS COD_FORNECEDOR, 
    NULL AS  COD_CENTRO_CUSTO,    
  CAST(E.COD_EMPRESA AS VARCHAR(10)) AS COD_EMPRESA,
  CAST(E.NOME AS VARCHAR(150)) AS EMPRESA,    
  NULL AS COD_GRUPO_PC,
  NULL AS GRUPO_PC,     
  CAST(VE.COD_PRODUTO AS VARCHAR(30)) AS COD_ITEM,  
    P.DESCRICAO_PRODUTO AS ITEM,
    VE.NOVO_USADO,
    NULL AS COD_GRUPO_INTERNO,
    NULL AS COD_SUB_GRUPO_INTERNO,    
    V.COD_NATUREZA AS COD_NATUREZA,   
    NULL AS COD_OPERACAO_FISCAL,
    NULL AS DESCONTO_RATEADO,
    0 AS DIAS_GIRO,
    NVL(V.GRUPO,VP.GRUPO) AS GRUPO,
  VE.CUSTO_TOTAL_FINAL AS CUSTO_RESULTANTE, -- CUSTO_OP OU CUSTO_RESUL SEMELHANTES = CUSTO PROD    
    1 AS QUANT,
    0 AS QUANT_DEV,
  VE.CUSTO_TOTAL_FINAL AS CUSTO_PRODUTO, -- CUSTO_OP OU CUSTO_RESUL SEMELHANTES = CUSTO PROD
  VP.VALOR_PROPOSTA AS PUNIT, -- USE AQUI
  (VP.DESCONTO + VP.DESCONTO_OUTROS) AS DESC_PUNIT,
  VP.VALOR_PROPOSTA AS PVENDIDO,
  VE.MARGEM_FINAL AS MARGEM,
  VP.VALOR_PROPOSTA AS TOTAL_NOTA,
  VP.VALOR_PROPOSTA AS TOTAL_VENDA_SDEV,
  0 AS TOTAL_VENDA_CDEV,  
  0 AS TOTAL_DEVOLVIDO,
  VP.DESCONTO AS DESC_TOTAL,
  V.NUMERO_OS AS NUMERO_OS,
  NULL AS COD_TIPO_OS,
  NULL AS TIPO_OS,
  NULL AS INTERNO,
  NULL AS GERA_FINANCEIRO,
    VE.COD_MODELO,                      
    V.COD_OPERACAO AS COD_OPERACAO,
    V.COD_SETOR AS COD_SETOR, 
    NULL AS COD_EMPRESA_DIVISAO,
  EU.NOME AS COD_VENDEDOR,
    EU.NOME_COMPLETO AS VENDEDOR,    
    V.COD_EMPRESA_DEPARTAMENTO AS COD_EMPRESA_DEPARTAMENTO,   
    'VEICULOS' AS TABREF   

  
FROM VEICULOS_PROPOSTAS VP  

INNER JOIN CLIENTES C ON C.COD_CLIENTE = VP.COD_CLIENTE

LEFT JOIN CLIENTE_DIVERSO CD ON CD.COD_CLIENTE = C.COD_CLIENTE

LEFT JOIN VENDAS V ON V.COD_PROPOSTA = VP.COD_PROPOSTA AND V.COD_EMPRESA = VP.COD_EMPRESA AND V.STATUS = 0

LEFT JOIN EMPRESAS E ON E.COD_EMPRESA = VP.COD_EMPRESA_VENDA

LEFT JOIN VEICULOS VE  ON VE.COD_PRODUTO = VP.COD_PRODUTO AND VE.COD_CLIENTE= VP.COD_CLIENTE AND VE.CHASSI_RESUMIDO = VP.CHASSI_RESUMIDO

LEFT JOIN PRODUTOS P ON P.COD_PRODUTO  = VE.COD_PRODUTO

LEFT JOIN EMPRESAS_USUARIOS EU ON EU.NOME = VP.VENDEDOR

WHERE VP.DATA_VENDA BETWEEN ADD_MONTHS(TRUNC(SYSDATE, 'MM'), -12) AND TRUNC(SYSDATE, 'DD') AND
VP.STATUS_PROPOSTA = 'V'



UNION ALL 



SELECT  
  'NBS' AS SYSORIGEM,
    C.COD_CLIENTE AS CODCLIENTE,
    C.NOME AS CLIENTE,    
    CASE WHEN CD.CPF IS NULL THEN CD.CGC
         WHEN CD.CGC IS NULL THEN CD.CPF 
         END AS DOCCLI,    
  TO_CHAR(os.DATA_EMISSAO, 'YYYY/MM/DD') AS DATA_NF,    
  V.CONTROLE,
    CAST(V.SERIE AS VARCHAR(10)) AS SERIE,
  OP.COD_NATUREZA_RECEITA_DESPESA,
    CAST(OS.STATUS_OS AS VARCHAR(30)) AS STATUS,  
    NULL AS COD_FORNECEDOR,  
    CAST(CC.COD_CENTRO_CUSTO AS VARCHAR(30)) AS COD_CENTRO_CUSTO,    
  CAST(OS.COD_EMPRESA AS VARCHAR(10)) AS COD_EMPRESA ,
  CAST(E.NOME AS VARCHAR(150)) AS EMPRESA,  
  OS.COD_GRUPO_PC AS COD_GRUPO_PC,
    G.DESCRICAO AS GRUPO_PC,      
  CAST(S.COD_SERVICO AS VARCHAR(30)) AS COD_ITEM,     
    S.DESCRICAO_SERVICO AS SERVICO, 
    'N' AS NOVO_USADO,
    NULL AS COD_GRUPO_INTERNO,
    NULL AS COD_SUB_GRUPO_INTERNO,      
    V.COD_NATUREZA,   
    NULL AS COD_OPERACAO_FISCAL, 
    OSR.DESCONTO_RATEADO, 
    0 AS DIAS_GIRO,
  CD.cliente_especial_grupo AS GRUPO,
  NULL AS CUSTO_RESULTANTE,
  1 AS QUANT,
    0 AS QUANT_DEV,
  S.PRECO_CUSTO AS CUSTO_PRODUTO, 
  OSR.PRECO_LIQUIDO_FINAL AS PUNIT,
    OSR.VALOR_DESCONTO_SERV AS DESC_UNIT,
    OSR.PRECO_VENDA AS PVENDIDO,
  NULL AS MARGEM,
  V.TOTAL_NOTA,
  NULL AS TOTAL_VENDA_SDEV,
    NULL AS TOTAL_VENDA_CDEV,
  NULL AS TOTAL_DEVOLVIDO,
  DECODE (OS.ORCAMENTO, 'S', ORC_ITEM_DESCONTO, DESCONTOS_ITENS) AS DESC_TOTAL, -- USE AQUI -- OBS ESSE DESC É GERAL, P/ REALIZAR DESC_UNIT DIVIDA POR QUANT TOTAL DE ITENS
  OS.NUMERO_OS,
  OST.TIPO AS COD_TIPO_OS,
  OST.DESCRICAO AS TIPO_OS,
  OST.INTERNO,
    OST.GERA_FINANCEIRO,
    V.COD_MODELO,                      
    V.COD_OPERACAO,
    V.COD_SETOR,
    V.COD_EMPRESA_DIVISAO,
  EU.NOME AS COD_VENDEDOR,
    EU.NOME_COMPLETO AS VENDEDOR,    
    V.COD_EMPRESA_DEPARTAMENTO,
    'SERVIÇOS' AS TABREF
    
FROM OS
INNER JOIN VENDAS V ON V.NUMERO_OS = OS.NUMERO_OS AND V.COD_EMPRESA  = OS.COD_EMPRESA AND V.COD_CLIENTE  = OS.COD_CLIENTE 
LEFT JOIN VENDA_OS VO ON V.CONTROLE = VO.CONTROLE AND V.COD_EMPRESA = VO.COD_EMPRESA AND V.SERIE  = VO.SERIE
INNER JOIN OS_SERVICOS OSR ON OSR.NUMERO_OS = OS.NUMERO_OS
LEFT JOIN SERVICOS S ON S.COD_SERVICO = OSR.COD_SERVICO
INNER JOIN os_dados_veiculos DV ON DV.NUMERO_OS = OS.NUMERO_OS AND OS.COD_EMPRESA = DV.COD_EMPRESA
INNER JOIN CLIENTES C ON C.COD_CLIENTE = OS.COD_CLIENTE
LEFT JOIN CLIENTE_DIVERSO CD ON OS.COD_CLIENTE = CD.COD_CLIENTE
LEFT JOIN VW_LGPD_RE01 RE1 ON RE1.COD_CLIENTE =  CD.COD_CLIENTE
LEFT JOIN OPERACOES OP ON OP.COD_EMPRESA = V.COD_EMPRESA AND OP.COD_OPERACAO = V.COD_OPERACAO
LEFT JOIN produtos P ON  OS.COD_PRODUTO = P.COD_PRODUTO
LEFT JOIN GRUPO_PC G ON G.COD_GRUPO_PC = S.COD_GRUPO_SERV 
LEFT JOIN MARCAS M ON M.COD_MARCA = P.COD_MARCA
LEFT JOIN PRODUTOS_MODELOS PM ON PM.COD_MODELO = OS.COD_MODELO AND OS.COD_PRODUTO = PM.COD_PRODUTO
LEFT JOIN setor_venda SV ON SV.COD_SETOR = OS.COD_SETOR_VENDA 
LEFT JOIN os_status OSS ON OSS.STATUS_OS  = os.status_os
LEFT JOIN centro_custo CC ON CC.COD_CENTRO_CUSTO = os.cod_centro_custo AND CC.COD_GRUPO_PC = os.cod_grupo_pc
LEFT JOIN OS_Tipos OST ON OST.TIPO = OS.TIPO 
LEFT JOIN empresas_usuarios EU ON EU.nome = os.quem_abriu 
LEFT JOIN EMPRESAS E ON E.COD_EMPRESA = V.COD_EMPRESA

WHERE OS.ORCAMENTO = 'N'
    And Nvl(OS.Apagar_Ao_Sair, 'N') = 'N'
  And OS.STATUS_OS = 1
  and (os.data_encerrada >= ADD_MONTHS(TRUNC(SYSDATE, 'MM'), -12))
    and (os.data_encerrada &lt; TRUNC(SYSDATE, 'MM'))
    and V.SERIE &lt;&gt; '1'
  and OST.INTERNO &lt;&gt; 'S'  
  and NVL(V.STATUS,'') &lt;&gt; 1
  
--ORDER BY 2  </sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>848</xloc>
      <yloc>80</yloc>
    </GUI>
  </transform>
  <transform>
    <name>clientes_newcon</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>NEWCON</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT  

    'NEWCON' AS SYSORIGEM, 

    CORCC023.ID_PESSOA AS CODCLIENTE,   

    CORCC023.NM_PESSOA AS CLIENTE, 

    CORCC023.CD_Inscricao_Nacional as DOCCLI,

    CASE CORCC023.ST_Tipo_Pessoa 

        WHEN 'F' THEN 'FISICA' 

        WHEN 'J' THEN 'JURIDICA' 

    ELSE 'OUTRA' END AS TIPOFJ,

    CORCC019.NM_Tipo_Endereco AS TIPOENDERECO,
    
    'S' AS ENDERECOPRINCIPAL,

    CORCC015.NM_Cidade AS CIDADE,

    CORCC015.ID_UF AS UF,

    CORCC026.Bairro AS BAIRRO,

    CORCC026.Endereco AS LOGRADOURO,

    CORCC026.NO_Endereco AS NUMERO,

    CORCC026.Complemento AS COMPLEMENTO,

    CORCC026.CEP AS CEP,

    CORCC030.E_Mail AS EMAIL,

    CELL.Telefone AS CELL,

    TELL.Telefone AS TELL,

    CASE WHEN CORCC023.ST_Tipo_Pessoa = 'F' 

            THEN (SELECT DH_Inclusao FROM CORCC023A WHERE ID_Pessoa = CORCC023.ID_PESSOA)

            ELSE (SELECT DH_Inclusao FROM CORCC023B WHERE ID_Pessoa = CORCC023.ID_PESSOA)

        END AS DATA_CADASTRO,

 

        (SELECT MAX(CONFI005.DT_Pagamento)

        FROM CONVE002 

        INNER JOIN CONVE034 ON CONVE034.ID_Cota = CONVE002.ID_Cota

        INNER JOIN CONFI005C ON CONFI005C.ID_Cota = CONVE034.ID_Cota AND CONFI005C.ID_Assembleia = CONVE034.ID_Assembleia

        INNER JOIN CONFI005 ON CONFI005.ID_Movimento_Grupo = CONFI005C.ID_Movimento_Grupo

        WHERE CONFI005.ID_Grupo_Movto_Fin = '01'  AND CONVE002.ID_Pessoa = CORCC023.ID_PESSOA) AS DATA_ULTIMA_ATUALIZACAO

        /*

        (SELECT CAST(ISNULL(SUM(CONFI005.VL_Lancamento),0) AS DECIMAL(15,2))

        FROM CONVE002 

        INNER JOIN CONVE034 ON CONVE034.ID_Cota = CONVE002.ID_Cota

        INNER JOIN CONFI005C ON CONFI005C.ID_Cota = CONVE034.ID_Cota AND CONFI005C.ID_Assembleia = CONVE034.ID_Assembleia

        INNER JOIN CONFI005 ON CONFI005.ID_Movimento_Grupo = CONFI005C.ID_Movimento_Grupo

        WHERE CONFI005.ID_Grupo_Movto_Fin = '01'  AND CONVE002.ID_Pessoa = CORCC023.ID_PESSOA) AS FATNEWCON 
        */

 

FROM CORCC023 -- PESSOA

    LEFT JOIN CORCC030 --EMAIL
    ON 
    CORCC023.ID_PESSOA = CORCC030.ID_PESSOA

    AND CORCC030.ID_E_Mail = (  SELECT MAX(ULT_EMAIL.ID_E_Mail) AS ID_E_MAIL
                                FROM CORCC030 AS ULT_EMAIL
                                WHERE ULT_EMAIL.ID_Pessoa = CORCC023.ID_PESSOA) 

    LEFT JOIN CORCC026 --ENDERECO
    ON 
    CORCC023.ID_PESSOA = CORCC026.ID_PESSOA

    AND CORCC026.ID_Endereco = (    CASE WHEN CORCC023.ST_Tipo_Pessoa = 'F' 
                                        THEN (  SELECT MAX(ULT_END_RES.ID_Endereco) AS ID_ENDERECO
                                                FROM CORCC026 AS ULT_END_RES
                                                WHERE ULT_END_RES.ID_Pessoa = CORCC023.ID_PESSOA)

                                        ELSE (  SELECT MAX(ULT_END_RES.ID_Endereco) AS ID_ENDERECO
                                                FROM CORCC026 AS ULT_END_RES
                                                WHERE ULT_END_RES.ID_Pessoa = CORCC023.ID_PESSOA)
                                        END)
    LEFT JOIN [dbo].[CORCC019] 
    ON 
    CORCC019.ID_Tipo_Endereco = CORCC026.ID_Tipo_Endereco

    LEFT JOIN CORCC015 -- CIDADES
    ON 
    CORCC015.ID_Cidade = CORCC026.ID_Cidade

    LEFT JOIN CORCC027 AS CELL -- TELEFONE CELULAR
    ON 
    CORCC023.ID_PESSOA = CELL.ID_PESSOA

    AND CELL.ID_Telefone = (SELECT MAX(ULT_TEL.ID_Telefone) AS ID_Telefone
                            FROM CORCC027 AS ULT_TEL
                            WHERE ULT_TEL.ID_Pessoa = CORCC023.ID_PESSOA AND ULT_TEL.ID_Tipo_Telefone = 3 /*Celular*/)

    LEFT JOIN CORCC027 AS TELL -- TELEFONE CELULAR
    ON 
    CORCC023.ID_PESSOA = TELL.ID_PESSOA

    AND TELL.ID_Telefone = (SELECT MAX(ULT_TEL.ID_Telefone) AS ID_Telefone
                            FROM CORCC027 AS ULT_TEL
                            WHERE ULT_TEL.ID_Pessoa = CORCC023.ID_PESSOA AND ULT_TEL.ID_Tipo_Telefone = 1 /*Comercial*/)

WHERE EXISTS (SELECT ID_PESSOA FROM CONVE002 WHERE ID_Pessoa = CORCC023.ID_PESSOA)</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>192</xloc>
      <yloc>384</yloc>
    </GUI>
  </transform>
  <transform>
    <name>newcon_faturamento</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>NEWCON</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT * FROM

(SELECT
	'NEWCON' AS SYSORIGEM, 
       '1' AS CODEMPRESA,
	'BAMAQ CONSÓRCIO' AS EMPRESA,
	'BAMAQ CONSÓRCIO' AS BANDEIRA,
	CASE CORCC023.ST_Tipo_Pessoa 
		WHEN 'F' THEN 'FISICA' 
		WHEN 'J' THEN 'JURIDICA' 
	ELSE 'OUTRA' END AS TIPOFJ,
	CORCC023.CD_Inscricao_Nacional as DOCCLI,
	CORCC023.ID_PESSOA AS CODCLIENTE, 	
	'Consórcio' as TIPO_OPERACAO,
	'Consórcios' as TIPO_VENDA,
	CONCC025.NM_Tipo_Documento AS TIPO_DOCUMENTO,	
	CONCC030.DT_Cadastro AS DATA_CADASTRO, 
	CONVE002D.DT_Venda AS DATA_ALOCACAO, 
	CONCC030.ID_Documento AS DOCUMENTO,
	CONVE001.NM_Fantasia AS DEPARTAMENTO,
	'Venda de Consórcios' OPERACAO,
	CONBE002.NM_Categoria_Produto as TIPO_PRODUTO,
	CONBE001.NM_Segmento_Bem AS GRUPO_PRODUTO,
	CONBE007.NM_Bem  as PRODUTO,
	'1' as QTDE,
       CONCC030.VL_Bem as VLR_BEM_CONTRATADO,
	ISNULL(CONVE009.NM_Equipe,'NÃO IDENTIFICADA') AS EQUIPE_VENDA,
	CONVE002.ID_Grupo AS GRUPO,
	CONVE002.CD_Cota AS COTA,
	CONVE002.ID_Cota AS ID_COTA,
	CONVE002.Versao AS VERSAO,
	CONVE002.PZ_Cota as QT_PARCELAS,
	dbo.fn_VeVLBemCota(CONVE002.ID_Cota, CORCC000.DT_Base_Processamento, 0) AS VALOR_ATUAL_BEM, -- 0 - Valor atual, 1 - Valor Historico, 2 - Boleto com Previa  
	ISNULL(dbo.fn_VeNoPcCota(CONVE002.ID_Cota, dbo.fn_dsVeNoNoAssembleia(CONVE002.ID_Cota, CORCC000.DT_Base_Processamento)),0) AS NO_PC_ATUAL,
	ISNULL(dbo.fn_VeNOPCPagas(CONVE002.ID_Cota),0) AS QT_PC_PAGAS,
       VP.VL_Amortizado AS VLR_LIQUIDO_TOTAL_ITEM,
	VP.VL_FC AS VL_PAGO_F_COMUM,
	VP.VL_FR AS VL_PAGO_F_RESERVA,
	VP.VL_SG AS VL_PAGO_SEGURO,
	VP.VL_MU AS VL_PAGO_MULTA,
	VP.VL_JU AS VL_PAGO_JUROS,
	VP.VL_TA AS VL_PAGO_TX_ADM

FROM CONVE002

INNER JOIN CONVE002D
ON
CONVE002D.ID_Cota = CONVE002.ID_Cota

INNER JOIN CONCC030
ON
CONCC030.ID_CONCC030 = CONVE002.ID_CONCC030

INNER JOIN CORCC023 -- PESSOA
ON 
CORCC023.ID_Pessoa = CONVE002.ID_Pessoa

INNER JOIN CONGR001 -- GRUPO
ON 
CONVE002.ID_Grupo = CONGR001.ID_Grupo

LEFT JOIN CONBE003 -- CADASTRO DE PRODUTOS
ON 
CONBE003.ID_Produto = CONGR001.ID_Produto

LEFT JOIN CONBE002 -- CATEGORIA DE PRODUTOS
ON 
CONBE003.ID_Categoria_Produto =  CONBE002.ID_Categoria_Produto

LEFT JOIN CONBE001 -- SEGMENTO DE PRODUTOS
ON 
CONBE001.ID_Segmento_Bem = CONBE002.ID_Segmento_Bem

LEFT JOIN CONCC025 -- TIPO DE DOCUMENTO
ON 
CONCC025.ID_Tipo_Documento = CONCC030.ID_Tipo_Documento

LEFT JOIN CONBE007  -- CADASTRO DO BEM
ON
CONBE007.ID_Bem = CONCC030.ID_Bem

LEFT JOIN CONVE009  -- CADASTRO DA EQUIPE DE BEM
ON
CONVE009.ID_Equipe_Venda = CONCC030.ID_Equipe_Venda

LEFT JOIN CONVE001  -- CADASTRO DA EQUIPE DE BEM
ON
CONVE001.ID_Ponto_Venda = CONVE002.ID_Ponto_Venda

LEFT JOIN dbo.vw_VeVlAmortizado VP 
ON
VP.ID_Cota = CONVE002.ID_Cota

CROSS JOIN CORCC000  

WHERE CONVE002.Versao = 0

--ORDER BY 5 

)T1


WHERE DATA_CADASTRO >= DATEADD(MONTH, -12, GETDATE())</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>848</xloc>
      <yloc>368</yloc>
    </GUI>
  </transform>
  <transform>
    <name>clientes_quiver</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>QUIVER</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>--QUIVER
SELECT
       T1.SYSORIGEM
      ,T1.CODCLIENTE
      ,T1.CLIENTE
      ,T1.TIPO_ENDERECO
      ,T1.ENDERECOPRINCIPAL
      ,T1.UF
      ,T1.CIDADE
      ,T1.BAIRRO
      ,T1.LOGRADOURO
      ,T1.NUMERO
      ,T1.COMPLEMENTO
      ,T1.CEP
      ,T1.EMAIL
      ,T1.TELL
      ,T1.CELULAR AS CELL
      ,T1.TIPOFJ
      ,T1.DOCCLI
      ,T1.DATA_CADASTRO
      ,T1.DATA_ULTIMA_ATUALIZACAO    

FROM
    (   SELECT 
              'QUIVER' AS SYSORIGEM
              ,c.Cliente AS CODCLIENTE
              ,c.Cgc_cpf as DOCCLI
              ,c.Nome AS CLIENTE
              ,te.Descricao AS TIPO_ENDERECO
              ,CASE WHEN e.End_corresp = 1 THEN 'SIM' ELSE 'NÃO' END AS ENDERECOPRINCIPAL
              ,e.Estado AS UF
              ,e.Cidade AS CIDADE
              ,e.Bairro AS BAIRRO
              ,e.Endereco as LOGRADOURO
              ,e.Numero as NUMERO
              ,e.Complemento as COMPLEMENTO
              ,e.Cep AS CEP

              ,CASE WHEN c.Tipo_pessoa = 'F' THEN 'FISICA'
                    WHEN c.Tipo_pessoa = 'J' THEN 'JURIDICA' 
                    END AS TIPOFJ
              ,c.E_mail AS EMAIL

              ,(SELECT TOP 1 ISNULL(DDD,'') + ISNULL(Telefone,'') 
                FROM Tabela_ClientFones 
                WHERE Cliente = c.Cliente and Tipo_telefone = 4 and Situacao = 'A'
                ORDER BY Data_inclusao DESC) AS CELULAR

              ,(SELECT TOP 1 ISNULL(DDD,'') + ISNULL(Telefone,'') 
                FROM Tabela_ClientFones 
                WHERE Cliente = c.Cliente and Tipo_telefone = 1 and Situacao = 'A'
                ORDER BY Data_inclusao DESC) AS TELL

              ,c.Data_inclusao AS DATA_CADASTRO
              ,c.Data_alteracao AS DATA_ULTIMA_ATUALIZACAO

        FROM Tabela_Clientes c

        LEFT JOIN ( SELECT cliente, MAX(Data_inclusao) as Data_inclusao
                    FROM Tabela_ClientEnder 
                    GROUP BY Cliente ) ult_e on ult_e.cliente = c.cliente  -- Endereço de ultima atualização.

        LEFT JOIN Tabela_ClientEnder e 
        ON
        e.Cliente = C.cliente and e.Cliente = ult_e.Cliente and e.Data_inclusao = ult_e.Data_inclusao

        LEFT JOIN Tabela_TiposEndereco te 
        ON
        te.Tipo_endereco = e.Tipo_endereco

        WHERE EXISTS (SELECT * FROM Tabela_Documentos WHERE Cliente = c.Cliente )
) AS T1</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>192</xloc>
      <yloc>192</yloc>
    </GUI>
  </transform>
  <transform>
    <name>quiver_faturamento</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>QUIVER</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>--APENAS CLIENTES COM FATURAMENTO NOS ULTIMOS 12 MESES

SELECT * FROM

(SELECT 

 T1.SYSORIGEM
,T1.CODEMPRESA
,T1.CODCLIENTE
,REPLACE(REPLACE(REPLACE(T2.DOCCLI, '.', ''), '/', ''), '-', '') AS DOCCLI
,T1.KEYREF
,T1.DOCUMENTO
,T1.ALTERACAO
,T1.DATA_OPERACAO
,T1.VALOR_COMISSA_VL
,T1.COD_OPERACAO
,T1.OPERACAO
,T1.STATUS_FINANCEIRO
,T1.NIVEL
,T1.COD_DIVISAO
,T1.DIVISAO
,T1.APOLICE
,T1.CLIENTE
,T1.COD_SEGURADORA
,T1.SEGURADORA 
,T1.COD_PRODUTO
,T1.PRODUTO
,T1.COD_RAMO
,T1.TIPO_NEGOCIO
,T1.COD_GRUPO_HIERAR
,T1.GRUPO_HIERAR
,HIE_NV1
,HIE_NV2
,HIE_NV3
,HIE_NV4
,T1.TIPO_ENDOSSO
,T1.COD_TP_DOC
,T1.TP_DOC
,T1.COD_SUB_TIPO
,T1.DESC_SUB_TIPO
,T1.PREMIO_LIQUIDO
,T1.PREMIO_TOTAL
,T1.PREMIO_LIQDESC
,T1.COMISSAO
,T1.PARCELA_INICIAL
,T1.DATA_PROPOSTA
,T1.DATA_VENC_PRIMEIRA
,T1.DATA_INCLUSAO
,T1.DATA_EMISSAO
,T1.DATA_ENTRADA
,T1.DATA_QUITCOM
,T1.INICIO_VIGENCIA
,T1.TERMINO_VIGENCIA
,T1.FORMA_RECEBIMENTO
,T1.COMISSAO_QUITADA
,T1.PROPOSTA
,T1.QTDE_PARC_COMIS




FROM


(SELECT

 'QUIVER' AS SYSORIGEM
,'1' AS CODEMPRESA
,T1.COD_CLIENTE AS CODCLIENTE
,T1.KEYREF
,T1.DOCUMENTO
,T1.ALTERACAO
,T1.DATA_OPERACAO
,T1.VALOR_COMISSA_VL
,T1.COD_OPERACAO

,CASE WHEN T1.COD_OPERACAO = 'C' THEN 'COMISSAO RECEBIDA' 
      WHEN T1.COD_OPERACAO = 'D' THEN 'COMISSAO PENDENTE'
	  END AS OPERACAO

,CASE WHEN T1.COD_OPERACAO = 'C' THEN 'RECEBIDA'
	      WHEN T1.COD_OPERACAO = 'D' AND T1.DATA_OPERACAO &lt;= GETDATE() THEN 'PENDENTE VENCIDA'
		  WHEN T1.COD_OPERACAO = 'D' AND T1.DATA_OPERACAO  > GETDATE() THEN 'PENDENTE A VENCER'
		  ELSE '***' END AS STATUS_FINANCEIRO

,T1.NIVEL
,T1.COD_DIVISAO
,T1.DIVISAO
,T1.APOLICE
,T1.CLIENTE
,T1.COD_SEGURADORA
,T1.SEGURADORA 
,T1.COD_PRODUTO
,T1.PRODUTO
,T1.COD_RAMO
,T1.TIPO_NEGOCIO
,T1.COD_GRUPO_HIERAR
,T1.GRUPO_HIERAR
,CASE   WHEN T1.GRUPO_HIERAR_NV1 IS NOT NULL THEN T1.GRUPO_HIERAR_NV1
        WHEN T1.GRUPO_HIERAR_NV2 IS NOT NULL THEN T1.GRUPO_HIERAR_NV2
		WHEN T1.GRUPO_HIERAR_NV3 IS NOT NULL THEN T1.GRUPO_HIERAR_NV3
        WHEN T1.GRUPO_HIERAR_NV4 IS NOT NULL THEN T1.GRUPO_HIERAR_NV4 
 ELSE '' 
 END AS HIE_NV1 

,CASE    WHEN T1.GRUPO_HIERAR_NV1 IS NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NULL
		 THEN '' --Return

		 WHEN T1.GRUPO_HIERAR_NV1 IS NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NOT NULL
		 THEN T1.GRUPO_HIERAR_NV4 --Return

		 WHEN T1.GRUPO_HIERAR_NV1 IS NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NOT NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NOT NULL
		 THEN T1.GRUPO_HIERAR_NV3 --Return

		 WHEN T1.GRUPO_HIERAR_NV1 IS NOT NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NOT NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NOT NULL
		 THEN T1.GRUPO_HIERAR_NV2 --Return

 ELSE '' 
 END AS HIE_NV2

,CASE    WHEN T1.GRUPO_HIERAR_NV1 IS NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NULL
		 THEN '' --Return

		 WHEN T1.GRUPO_HIERAR_NV1 IS NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NOT NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NOT NULL
		 THEN T1.GRUPO_HIERAR_NV4 --Return

		 WHEN T1.GRUPO_HIERAR_NV1 IS NOT NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NOT NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NOT NULL
		 THEN T1.GRUPO_HIERAR_NV3 --Return

 ELSE '' 
 END AS HIE_NV3

,CASE    WHEN T1.GRUPO_HIERAR_NV1 IS NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NULL
		 THEN '' --Return

		 WHEN T1.GRUPO_HIERAR_NV1 IS NOT NULL 
          AND T1.GRUPO_HIERAR_NV2 IS NOT NULL
		  AND T1.GRUPO_HIERAR_NV3 IS NOT NULL
		 THEN T1.GRUPO_HIERAR_NV4 --Return

 ELSE '' 
 END AS HIE_NV4
,T1.TIPO_ENDOSSO
,T1.COD_TP_DOC
,T1.TP_DOC
,T1.COD_SUB_TIPO
,T1.DESC_SUB_TIPO
,T1.PREMIO_LIQUIDO
,T1.PREMIO_TOTAL
,T1.PREMIO_LIQDESC
,T1.COMISSAO
,T1.PARCELA_INICIAL
,T1.DATA_PROPOSTA
,T1.DATA_VENC_PRIMEIRA
,T1.DATA_INCLUSAO
,T1.DATA_EMISSAO
,T1.DATA_ENTRADA
,T1.DATA_QUITCOM
,T1.INICIO_VIGENCIA
,T1.TERMINO_VIGENCIA
,T1.FORMA_RECEBIMENTO
,T1.COMISSAO_QUITADA
,T1.PROPOSTA
,T1.QTDE_PARC_COMIS


FROM
(SELECT

 T1.KEYREF
,T1.DOCUMENTO
,T1.ALTERACAO
,T1.DATA_OPERACAO
,T1.VALOR_COMISSA_VL
,T1.OPERACAO AS COD_OPERACAO
,T1.NIVEL
,T1.COD_DIVISAO
,T7.NOME AS DIVISAO
,T1.APOLICE
,T1.COD_CLIENTE
,T2.NOME AS CLIENTE
,T1.COD_SEGURADORA
,T3.NOME AS SEGURADORA 
,T1.COD_PRODUTO
,T4.NOME AS PRODUTO
,T4.RAMO AS COD_RAMO
,T1.TIPO_NEGOCIO
,T1.COD_GRUPO_HIERAR
,T1.TIPO_ENDOSSO
,T1.TP_DOC AS COD_TP_DOC
,UPPER(T5.DESCRICAO) AS TP_DOC
,T1.COD_SUB_TIPO
,UPPER(T6.DESCRICAO) AS DESC_SUB_TIPO
,T1.PREMIO_LIQUIDO
,T1.PREMIO_TOTAL
,T1.PREMIO_LIQDESC
,T1.COMISSAO
,T1.PARCELA_INICIAL
,T1.DATA_PROPOSTA
,T1.DATA_VENC_PRIMEIRA
,T1.DATA_INCLUSAO
,T1.DATA_EMISSAO
,T1.DATA_ENTRADA
,T1.DATA_QUITCOM
,T1.INICIO_VIGENCIA
,T1.TERMINO_VIGENCIA
,T1.FORMA_RECEBIMENTO
,T1.COMISSAO_QUITADA
,T1.PROPOSTA
,T1.QTDE_PARC_COMIS
,T8.NOME AS GRUPO_HIERAR
,LTRIM(PARSENAME(REPLACE(T8.NOME,'/','.'),4)) AS GRUPO_HIERAR_NV1
,LTRIM(PARSENAME(REPLACE(T8.NOME,'/','.'),3)) AS GRUPO_HIERAR_NV2
,LTRIM(PARSENAME(REPLACE(T8.NOME,'/','.'),2)) AS GRUPO_HIERAR_NV3
,LTRIM(PARSENAME(REPLACE(T8.NOME,'/','.'),1)) AS GRUPO_HIERAR_NV4


FROM

(SELECT

 T1.KEYREF
,T1.DOCUMENTO
,T1.ALTERACAO
,T1.DATA_OPERACAO
,T1.VALOR_COMISSA_VL
,T1.OPERACAO
,T1.NIVEL
,T1.DIVISAO AS COD_DIVISAO
,T2.APOLICE
,T2.CLIENTE    AS COD_CLIENTE
,T2.SEGURADORA AS COD_SEGURADORA
,T2.PRODUTO    AS COD_PRODUTO
,T2.TIPO_NEGOCIO
,T2.GRUPO_HIERARQUICO AS COD_GRUPO_HIERAR
,T2.TIPO_ENDOSSO
,T2.TIPO_DOCUMENTO AS TP_DOC
,T2.SUB_TIPO AS COD_SUB_TIPO
,T2.PREMIO_LIQUIDO
,T2.PREMIO_TOTAL
,T2.PREMIO_LIQDESC
,T2.COMISSAO
,T2.PARCELA_INICIAL
,CONVERT(VARCHAR,T2.DATA_PROPOSTA,103) AS DATA_PROPOSTA
,CONVERT(VARCHAR,T2.DATA_VENC_PRIMEIRA,103) AS DATA_VENC_PRIMEIRA
,CONVERT(VARCHAR,T2.DATA_INCLUSAO,103) AS DATA_INCLUSAO
,CONVERT(VARCHAR,T2.DATA_EMISSAO,103) AS DATA_EMISSAO
,CONVERT(VARCHAR,T2.DATA_ENTRADA,103) AS DATA_ENTRADA
,CONVERT(VARCHAR,T2.DATA_QUITCOM,103) AS  DATA_QUITCOM
,CONVERT(VARCHAR,T2.INICIO_VIGENCIA,103) AS INICIO_VIGENCIA
,CONVERT(VARCHAR,T2.TERMINO_VIGENCIA,103) AS TERMINO_VIGENCIA
,T2.FORMA_RECEBIMENTO
,T2.COMISSAO_QUITADA
,T2.Proposta
,T2.Qtde_parc_comis


FROM

(SELECT

 T1.KEYREF
,T1.DOCUMENTO
,T1.ALTERACAO
,T1.DATA_OPERACAO
,T1.VALOR AS VALOR_COMISSA_VL
,T1.OPERACAO
,T2.NIVEL
,T2.DIVISAO

FROM

(SELECT
 DOCUMENTO
,ALTERACAO
,CONCAT(DOCUMENTO,'-',ALTERACAO) AS KEYREF
,CONVERT(VARCHAR,DATA_OPERACAO,103) AS DATA_OPERACAO
,VALOR
,OPERACAO

FROM TABELA_DOCSPARCSCOM T1
WHERE data_operacao 
BETWEEN DATEADD(year, -3, DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0)) 
AND DATEADD(year, 1, DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0))

)T1

LEFT JOIN 

(SELECT * FROM

(SELECT DISTINCT
    CONCAT(T1.DOCUMENTO, '-', T1.ALTERACAO) AS KEYREF,
    T1.DOCUMENTO,
    T1.ALTERACAO,
    T1.NIVEL,
    T1.DIVISAO
FROM
    TABELA_DOCSREPASSES T1)T1

WHERE T1.NIVEL = 5)T2   ON T1.KEYREF = T2.KEYREF)T1

LEFT JOIN TABELA_DOCUMENTOS T2 on (T2.DOCUMENTO = T1.DOCUMENTO AND T2.ALTERACAO = T1.ALTERACAO))T1

LEFT JOIN TABELA_CLIENTES T2 ON T1.COD_CLIENTE = T2.CLIENTE
LEFT JOIN TABELA_SEGURADORAS T3 ON T1.COD_SEGURADORA = T3.SEGURADORA
LEFT JOIN TABELA_PRODUTOS T4 ON T1.COD_PRODUTO = T4.PRODUTO
LEFT JOIN TABELA_TIPOSDOCEMISS T5 ON T1.TP_DOC = T5.TIPO_DOCUMENTO
LEFT JOIN TABELA_SUBTIPOSDOC   T6 ON T1.COD_SUB_TIPO = T6.SUB_TIPO
LEFT JOIN TABELA_DIVISOES T7 ON T1.COD_DIVISAO = T7.DIVISAO
LEFT JOIN TABELA_GRUPOSHIERARQ T8 ON T1.COD_GRUPO_HIERAR = T8.GRUPO_HIERARQUICO)T1)T1
----------------------------------------------------------------------------------------------------

LEFT JOIN

(

SELECT

       T1.SYSORIGEM
      ,T1.CODCLIENTE
      ,T1.CLIENTE
      ,T2.UF
      ,T2.CIDADE
      ,T2.BAIRRO
      ,T2.ENDERECO AS LOGRADOURO
      ,T2.NUMERO
      ,T2.COMPLEMENTO
      ,T2.CEP
      ,T1.EMAIL
      ,T1.TELL
      ,NULL AS CELL
      ,T1.TIPOFJ
      ,T1.DOCCLI
      ,T1.DATA_CADASTRO
      ,T1.DATA_ULTIMA_ATUALIZACAO    

FROM

(SELECT 
       'QUIVER' AS SYSORIGEM
      ,T1.Cliente AS CODCLIENTE
      ,T1.Nome AS CLIENTE
      ,CASE WHEN T1.Tipo_pessoa = 'F' THEN 'FISICA'
            WHEN T1.Tipo_pessoa = 'J' THEN 'JURIDICA' 
            END AS TIPOFJ
      ,T1.Cgc_cpf AS DOCCLI
      ,T1.E_mail AS EMAIL
      ,T2.TELL
      ,T1.Data_inclusao AS DATA_CADASTRO
      ,T1.Data_alteracao AS DATA_ULTIMA_ATUALIZACAO

  FROM [Tabela_Clientes] T1

  LEFT JOIN

(SELECT

 T1.CLIENTE AS CODCLIENTE
,CONCAT(T2.DDD, T2.Telefone) AS TELL
FROM

(SELECT 
    
     CLIENTE
    ,MAX(CLIENTE_FONE) CLIENTE_FONE

FROM [Tabela_ClientFones]
  
GROUP BY CLIENTE)T1

LEFT JOIN [Tabela_ClientFones] T2 ON T1.CLIENTE_FONE = T2.Cliente_fone )T2 ON T1.Cliente = T2.CODCLIENTE)T1

LEFT JOIN

(SELECT

 T1.CODCLIENTE
,T2.ESTADO AS UF
,T2.CIDADE
,T2.BAIRRO
,T2.ENDERECO
,T2.NUMERO
,T2.COMPLEMENTO
,T2.CEP

FROM

(SELECT [Cliente] AS CODCLIENTE
      ,MAX([Cliente_end]) AS CLIENTE_END
     

  FROM [Tabela_ClientEnder]

  GROUP BY CLIENTE)T1

  LEFT JOIN [Tabela_ClientEnder] T2 ON T1.CLIENTE_END = T2.Cliente_end) T2 ON T1.CODCLIENTE = T2.CODCLIENTE
)T2     ON T1.CODCLIENTE = T2.CODCLIENTE)T1

 WHERE DATA_EMISSAO >=  DATEADD(MONTH, -12, GETDATE())</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>848</xloc>
      <yloc>176</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>
